# TianShanOS è‡ªåŠ¨åŒ–å¼•æ“è®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 2.1  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
> **æ›´æ–°æ—¥æœŸ**: 2026-01-28  
> **çŠ¶æ€**: æ ¸å¿ƒåŠŸèƒ½å·²å®ç°ï¼Œè§„åˆ™å¼•æ“å¢å¼ºå®Œæˆ

---

## ç›®å½•

1. [æ¦‚è¿°](#1-æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [æ•°æ®æºç³»ç»Ÿ](#3-æ•°æ®æºç³»ç»Ÿ)
4. [è§„åˆ™å¼•æ“](#4-è§„åˆ™å¼•æ“)
5. [åŠ¨ä½œç³»ç»Ÿ](#5-åŠ¨ä½œç³»ç»Ÿ)
6. [é…ç½® Schema](#6-é…ç½®-schema)
7. [WebUI Dashboard è®¾è®¡](#7-webui-dashboard-è®¾è®¡)
8. [ç»„ä»¶è®¾è®¡](#8-ç»„ä»¶è®¾è®¡)
9. [å®ç°è®¡åˆ’](#9-å®ç°è®¡åˆ’)
10. [é™„å½•](#10-é™„å½•)

---

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

TianShanOS è‡ªåŠ¨åŒ–å¼•æ“æ˜¯ä¸€ä¸ª**å¯é…ç½®çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ**ï¼Œç”¨äºï¼š

- ğŸ“Š **ç›‘æ§**: é‡‡é›† ESP32 æœ¬åœ°æ•°æ®å’Œè¿œç¨‹æœåŠ¡å™¨ï¼ˆAGX/LPMUï¼‰è¿è¡Œæ•°æ®
- ğŸ”„ **è‡ªåŠ¨åŒ–**: åŸºäºæ¡ä»¶è§„åˆ™è‡ªåŠ¨è§¦å‘åŠ¨ä½œ
- ğŸ–¥ï¸ **æ˜¾ç¤º**: å°†ç›‘æ§æ•°æ®å’Œç³»ç»ŸçŠ¶æ€å±•ç¤ºåˆ° LED ä¸‰ä¸ªæ˜¾ç¤ºåŒºåŸŸ
- ğŸ® **æ§åˆ¶**: é€šè¿‡ SSH æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨æ§åˆ¶å‘½ä»¤
- âš¡ **åé¦ˆ**: å‘½ä»¤æ‰§è¡Œç»“æœå¯è§¦å‘åç»­è§„åˆ™

### 1.2 æ ¸å¿ƒç†å¿µ

```
é¢å‘é…ç½®ï¼Œè€Œéé¢å‘ä»£ç 
```

ç”¨æˆ·é€šè¿‡ JSON é…ç½®ï¼ˆå¯é€šè¿‡ WebUI å¯è§†åŒ–ç¼–è¾‘ï¼‰å®šä¹‰ï¼š
- ç›‘æ§ä»€ä¹ˆæ•°æ®
- ä»€ä¹ˆæ¡ä»¶è§¦å‘ä»€ä¹ˆåŠ¨ä½œ
- LED æ˜¾ç¤ºä»€ä¹ˆå†…å®¹

### 1.3 æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ•°æ®æº (Source)** | æ•°æ®æ¥æºå®šä¹‰ | ESP32 å†…ç½®ã€WebSocketã€REST API |
| **å­—æ®µ (Field)** | æ•°æ®æºä¸­çš„å…·ä½“æ•°æ®ç‚¹ | `agx.cpu_temp`, `esp32.voltage` |
| **äº‹ä»¶ (Event)** | ç³»ç»Ÿä¸­å‘ç”Ÿçš„çŠ¶æ€å˜åŒ– | æ•°æ®æ›´æ–°ã€å‘½ä»¤å®Œæˆã€å®šæ—¶å™¨è§¦å‘ |
| **æ¡ä»¶ (Condition)** | åˆ¤æ–­è¡¨è¾¾å¼ | `agx.cpu_temp > 80 AND agx.gpu_temp > 75` |
| **åŠ¨ä½œ (Action)** | è¦æ‰§è¡Œçš„æ“ä½œ | LED æ˜¾ç¤ºã€SSH å‘½ä»¤ã€æ—¥å¿—è®°å½• |
| **è§„åˆ™ (Rule)** | è§¦å‘æ¡ä»¶ + åŠ¨ä½œåˆ—è¡¨ | å½“æ¸©åº¦è¿‡é«˜æ—¶ï¼Œæ˜¾ç¤ºè­¦å‘Šå¹¶æ‰§è¡Œé™é¢‘ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TianShanOS Automation Engine                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        äº‹ä»¶æº (Event Sources)                        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  ESP32 å†…ç½®         è¿œç¨‹æ•°æ®             å‘½ä»¤åé¦ˆ         ç³»ç»Ÿäº‹ä»¶   â”‚   â”‚
â”‚   â”‚  â€¢ system.*        â€¢ agx.* (WS)        â€¢ ssh.result.*  â€¢ timer.*   â”‚   â”‚
â”‚   â”‚  â€¢ network.*       â€¢ lpmu.* (REST)     â€¢ command.*     â€¢ startup   â”‚   â”‚
â”‚   â”‚  â€¢ adc.*           â€¢ custom.*                          â€¢ service.* â”‚   â”‚
â”‚   â”‚  â€¢ gpio.*                                                          â”‚   â”‚
â”‚   â”‚  â€¢ service.*                                                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      å˜é‡å­˜å‚¨ (Variable Store)                       â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   æ‰€æœ‰æ•°æ®ç‚¹ç»Ÿä¸€å­˜å‚¨ï¼Œæ”¯æŒå˜é‡å¼•ç”¨ ${source.field}                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        è§„åˆ™å¼•æ“ (Rule Engine)                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â€¢ æ¡ä»¶è¡¨è¾¾å¼è§£æä¸æ±‚å€¼                                             â”‚   â”‚
â”‚   â”‚   â€¢ è§¦å‘ç±»å‹ï¼šcondition / event / timer / startup                   â”‚   â”‚
â”‚   â”‚   â€¢ é˜²æŠ– (debounce) / æŒç»­æ—¶é—´ (sustain) / èŠ‚æµ (throttle)          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         åŠ¨ä½œæ‰§è¡Œ (Actions)                           â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  LED æ˜¾ç¤º         SSH å‘½ä»¤          GPIO æ§åˆ¶       å…¶ä»–åŠ¨ä½œ         â”‚   â”‚
â”‚   â”‚  â€¢ led.touch      â€¢ ssh.exec        â€¢ gpio.set      â€¢ log           â”‚   â”‚
â”‚   â”‚  â€¢ led.board      â€¢ ssh.exec_async  â€¢ gpio.toggle   â€¢ variable.set  â”‚   â”‚
â”‚   â”‚  â€¢ led.matrix                                       â€¢ trigger_rule  â”‚   â”‚
â”‚   â”‚                                                     â€¢ delay         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµ

```
æ•°æ®é‡‡é›† â”€â”€â–º å˜é‡å­˜å‚¨ â”€â”€â–º è§„åˆ™è¯„ä¼° â”€â”€â–º åŠ¨ä½œæ‰§è¡Œ
    â”‚                        â”‚              â”‚
    â”‚                        â”‚              â–¼
    â”‚                        â”‚         å‘½ä»¤åé¦ˆ â”€â”€â”
    â”‚                        â”‚                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (å¾ªç¯)
```

### 2.3 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TianShanOS ç»„ä»¶å…³ç³»                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ ts_event    â”‚â—„â”€â”€â”€â”€ æ‰€æœ‰ç»„ä»¶é€šè¿‡äº‹ä»¶æ€»çº¿é€šä¿¡                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚          â”‚                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚             â”‚                                               â”‚
â”‚   â–¼             â–¼                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚ â”‚ ts_led  â”‚  â”‚ts_automationâ”‚â—„â”€â”€â”€â”€ æ–°å¢ï¼šè‡ªåŠ¨åŒ–å¼•æ“               â”‚
â”‚ â”‚(Core API)â”‚  â”‚             â”‚                                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                     â”‚                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚          â–¼         â–¼          â–¼                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚    â”‚ts_source â”‚ â”‚ ts_rule  â”‚ â”‚ts_action â”‚                       â”‚
â”‚    â”‚æ•°æ®é‡‡é›†   â”‚ â”‚è§„åˆ™å¼•æ“   â”‚ â”‚åŠ¨ä½œæ‰§è¡Œ   â”‚                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚          â”‚                          â”‚                           â”‚
â”‚          â”‚                          â–¼                           â”‚
â”‚          â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚          â”‚                   â”‚ ts_security â”‚                    â”‚
â”‚          â”‚                   â”‚ (SSH æ‰§è¡Œ)  â”‚                    â”‚
â”‚          â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚   ts_net    â”‚                                               â”‚
â”‚   â”‚(WS/HTTPå®¢æˆ·ç«¯)â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®æºç³»ç»Ÿ

### 3.1 æ•°æ®æºç±»å‹

| ç±»å‹ | æ ‡è¯† | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|------|----------|
| **å†…ç½®** | `builtin` | ESP32 æœ¬åœ°æ•°æ® | ç›´æ¥è°ƒç”¨ ESP-IDF API |
| **WebSocket** | `websocket` | å®æ—¶æ¨é€æ•°æ® | esp_websocket_client |
| **REST** | `rest` | HTTP è½®è¯¢æ•°æ® | esp_http_client |
| **MQTT** | `mqtt` | MQTT è®¢é˜… (å¯é€‰) | esp_mqtt_client |

### 3.2 å†…ç½®æ•°æ®æºï¼ˆåŸºäºç°æœ‰ HAL/é©±åŠ¨ï¼‰

ESP32 æœ¬åœ°æ•°æ®é€šè¿‡ `builtin` ç±»å‹å®šä¹‰ï¼Œ**åŸºäºé¡¹ç›®ä¸­å·²å®ç°çš„ HAL å’Œé©±åŠ¨æ¨¡å—**ï¼š

#### 3.2.1 ç³»ç»Ÿæ•°æ® (`system.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ | æ¥æº API |
|-----------|------|------|------|----------|
| `system.heap_free` | å¯ç”¨å †å†…å­˜ | number | KB | `esp_get_free_heap_size()` |
| `system.heap_min_free` | å†å²æœ€å°å¯ç”¨å†…å­˜ | number | KB | `esp_get_minimum_free_heap_size()` |
| `system.psram_free` | å¯ç”¨ PSRAM | number | KB | `heap_caps_get_free_size(SPIRAM)` |
| `system.psram_total` | PSRAM æ€»é‡ | number | KB | `heap_caps_get_total_size(SPIRAM)` |
| `system.cpu_freq` | CPU é¢‘ç‡ | number | MHz | `ts_hal_get_capabilities()` |
| `system.uptime` | è¿è¡Œæ—¶é—´ | number | s | `esp_timer_get_time()` |
| `system.chip_temp` | èŠ¯ç‰‡æ¸©åº¦ | number | Â°C | æ¸©åº¦ä¼ æ„Ÿå™¨ API |
| `system.reset_reason` | ä¸Šæ¬¡é‡å¯åŸå›  | string | - | `esp_reset_reason()` |

#### 3.2.2 ç½‘ç»œæ•°æ® (`network.*`) - æ¥è‡ª ts_net

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ | æ¥æº API |
|-----------|------|------|------|----------|
| `network.wifi_connected` | WiFi è¿æ¥çŠ¶æ€ | bool | - | `ts_wifi_is_connected()` |
| `network.wifi_rssi` | WiFi ä¿¡å·å¼ºåº¦ | number | dBm | `ts_wifi_get_rssi()` |
| `network.wifi_ssid` | å½“å‰ SSID | string | - | `ts_wifi_get_ssid()` |
| `network.ip_address` | IP åœ°å€ | string | - | `ts_net_get_ip()` |
| `network.eth_connected` | ä»¥å¤ªç½‘è¿æ¥çŠ¶æ€ | bool | - | `ts_eth_is_connected()` |
| `network.eth_ip` | ä»¥å¤ªç½‘ IP | string | - | `ts_eth_get_ip()` |

#### 3.2.3 ç”µæºç›‘æ§ (`power.*`) - æ¥è‡ª ts_power_monitor

> **ç¡¬ä»¶**: ADC GPIO18 (åˆ†å‹æ¯” 11.4:1), UART GPIO47 (9600 8N1 ç”µæºèŠ¯ç‰‡)

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ | æ¥æº API |
|-----------|------|------|------|----------|
| `power.voltage` | ä¾›ç”µç”µå‹ | number | V | `ts_power_monitor_get_voltage_data()` |
| `power.current` | ç”µæµ | number | A | `ts_power_monitor_get_power_chip_data()` |
| `power.wattage` | åŠŸç‡ | number | W | è®¡ç®—å€¼ |
| `power.raw_adc` | ADC åŸå§‹å€¼ | number | - | `ts_adc_read_raw()` |

#### 3.2.4 è®¾å¤‡æ§åˆ¶çŠ¶æ€ (`device.*`) - æ¥è‡ª ts_device_ctrl

> **ç¡¬ä»¶å¼•è„š** (æ¥è‡ª `boards/rm01_esp32s3/pins.json`):
> - AGX: FORCE_SHUTDOWN(GPIO3), RESET(GPIO1), RECOVERY(GPIO40)
> - LPMU: POWER(GPIO46), RESET(GPIO2)

| builtin ID | è¯´æ˜ | ç±»å‹ | æ¥æº API |
|-----------|------|------|----------|
| `device.agx.state` | AGX ç”µæºçŠ¶æ€ | string | `ts_device_get_status(TS_DEVICE_AGX)` |
| `device.agx.power_good` | AGX ç”µæºæ­£å¸¸ | bool | GPIO è¯»å– |
| `device.agx.uptime` | AGX è¿è¡Œæ—¶é—´ | number | å†…éƒ¨è®¡æ—¶ |
| `device.lpmu.state` | LPMU ç”µæºçŠ¶æ€ | string | `ts_device_get_status(TS_DEVICE_LPMU)` |

#### 3.2.5 GPIO çŠ¶æ€ (`gpio.*`) - æ¥è‡ª ts_hal_gpio

| builtin ID | è¯´æ˜ | ç±»å‹ | æ¥æº API |
|-----------|------|------|----------|
| `gpio.<function_name>` | é€»è¾‘å¼•è„šç”µå¹³ | bool | `ts_gpio_get_level()` |

> **ç¤ºä¾‹**: `gpio.AGX_RESET`, `gpio.LPMU_POWER`, `gpio.ETH_RST`

#### 3.2.6 æœåŠ¡çŠ¶æ€ (`service.*`) - æ¥è‡ª ts_service

| builtin ID | è¯´æ˜ | ç±»å‹ | æ¥æº API |
|-----------|------|------|----------|
| `service.<name>.running` | æœåŠ¡æ˜¯å¦è¿è¡Œ | bool | `ts_service_is_running()` |
| `service.<name>.healthy` | æœåŠ¡æ˜¯å¦å¥åº· | bool | `ts_service_health_check()` |
| `service.pki.status` | PKI çŠ¶æ€ | string | `ts_cert_get_status()` |
| `service.pki.cert_days_left` | è¯ä¹¦å‰©ä½™å¤©æ•° | number | è¯ä¹¦è§£æ |

#### 3.2.7 LED çŠ¶æ€ (`led.*`) - æ¥è‡ª ts_led

| builtin ID | è¯´æ˜ | ç±»å‹ | æ¥æº API |
|-----------|------|------|----------|
| `led.touch.brightness` | Touch äº®åº¦ | number | `ts_led_get_brightness()` |
| `led.touch.effect` | Touch å½“å‰æ•ˆæœ | string | `ts_led_get_current_effect()` |
| `led.board.color` | Board LED é¢œè‰² | string | å†…éƒ¨çŠ¶æ€ |
| `led.matrix.effect` | Matrix å½“å‰æ•ˆæœ | string | `ts_led_get_current_effect()` |

### 3.3 è¿œç¨‹æ•°æ®æºé…ç½®

#### WebSocket æ•°æ®æº

```json
{
  "id": "agx",
  "name": "AGX Orin",
  "type": "websocket",
  "config": {
    "url": "ws://192.168.1.100:58090/socket.io/",
    "reconnect": true,
    "reconnect_interval": 5000,
    "ping_interval": 30000
  },
  "interval": 1000,
  "enabled": true,
  "fields": [
    {"id": "cpu_usage", "path": "cpu.percent", "name": "CPUä½¿ç”¨ç‡", "unit": "%", "type": "number"},
    {"id": "cpu_temp", "path": "cpu.temp", "name": "CPUæ¸©åº¦", "unit": "Â°C", "type": "number"},
    {"id": "gpu_usage", "path": "gpu.percent", "name": "GPUä½¿ç”¨ç‡", "unit": "%", "type": "number"},
    {"id": "gpu_temp", "path": "gpu.temp", "name": "GPUæ¸©åº¦", "unit": "Â°C", "type": "number"},
    {"id": "mem_used", "path": "memory.used_gb", "name": "å†…å­˜ä½¿ç”¨", "unit": "GB", "type": "number"},
    {"id": "mem_total", "path": "memory.total_gb", "name": "å†…å­˜æ€»é‡", "unit": "GB", "type": "number"},
    {"id": "power", "path": "power.watts", "name": "åŠŸè€—", "unit": "W", "type": "number"}
  ]
}
```

#### REST æ•°æ®æº

```json
{
  "id": "lpmu",
  "name": "LPMU æœåŠ¡å™¨",
  "type": "rest",
  "config": {
    "url": "http://192.168.1.101:8080/api/status",
    "method": "GET",
    "headers": {
      "Authorization": "Bearer ${secrets.lpmu_token}"
    },
    "timeout": 5000
  },
  "interval": 5000,
  "enabled": true,
  "fields": [
    {"id": "status", "path": "status", "name": "è¿è¡ŒçŠ¶æ€", "type": "string"},
    {"id": "model_name", "path": "inference.model", "name": "å½“å‰æ¨¡å‹", "type": "string"},
    {"id": "model_fps", "path": "inference.fps", "name": "æ¨ç†FPS", "type": "number"},
    {"id": "queue_length", "path": "inference.queue", "name": "é˜Ÿåˆ—é•¿åº¦", "type": "number"}
  ]
}
```

### 3.4 å­—æ®µè·¯å¾„è§£æ (JSON Path)

æ”¯æŒç®€åŒ–çš„ JSON Path è¯­æ³•ä»å“åº”ä¸­æå–æ•°æ®ï¼š

| è¯­æ³• | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| `key` | `status` | é¡¶å±‚å­—æ®µ |
| `key.subkey` | `cpu.temp` | åµŒå¥—å­—æ®µ |
| `key[0]` | `gpus[0]` | æ•°ç»„ç´¢å¼• |
| `key[0].subkey` | `gpus[0].temp` | æ•°ç»„å…ƒç´ çš„å­—æ®µ |

---

## 4. è§„åˆ™å¼•æ“

### 4.1 è§„åˆ™ç»“æ„

```json
{
  "id": "rule_id",
  "name": "è§„åˆ™åç§°",
  "enabled": true,
  "priority": 0,
  "trigger": { ... },
  "actions": [ ... ]
}
```

### 4.2 è§¦å‘å™¨ç±»å‹

#### 4.2.1 æ¡ä»¶è§¦å‘ (`condition`)

å½“è¡¨è¾¾å¼ç»“æœä» false å˜ä¸º true æ—¶è§¦å‘ï¼š

```json
{
  "type": "condition",
  "expression": "agx.cpu_temp > 80 AND agx.gpu_temp > 75",
  "debounce": 3000,
  "sustain": 0
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `expression` | æ¡ä»¶è¡¨è¾¾å¼ | å¿…å¡« |
| `debounce` | é˜²æŠ–æ—¶é—´ (ms)ï¼Œè§¦å‘å N æ¯«ç§’å†…ä¸é‡å¤è§¦å‘ | 0 |
| `sustain` | æŒç»­æ—¶é—´ (ms)ï¼Œæ¡ä»¶éœ€æŒç»­æ»¡è¶³ N æ¯«ç§’æ‰è§¦å‘ | 0 |

#### 4.2.2 äº‹ä»¶è§¦å‘ (`event`)

å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘ï¼š

```json
{
  "type": "event",
  "event": "ssh.completed",
  "filter": "ssh.last.host == 'agx_ssh' AND ssh.last.exit_code != 0"
}
```

**æ”¯æŒçš„äº‹ä»¶**:

| äº‹ä»¶ | è¯´æ˜ | é™„åŠ æ•°æ® |
|------|------|---------|
| `data.updated.<source_id>` | æ•°æ®æºæ›´æ–° | æ›´æ–°çš„å­—æ®µåˆ—è¡¨ |
| `ssh.completed` | SSH å‘½ä»¤å®Œæˆ | exit_code, stdout, stderr |
| `network.wifi_connected` | WiFi è¿æ¥æˆåŠŸ | IP åœ°å€ |
| `network.wifi_disconnected` | WiFi æ–­å¼€ | - |
| `service.started.<name>` | æœåŠ¡å¯åŠ¨ | - |
| `service.stopped.<name>` | æœåŠ¡åœæ­¢ | - |
| `startup` | ç³»ç»Ÿå¯åŠ¨å®Œæˆ | - |

#### 4.2.3 å®šæ—¶è§¦å‘ (`timer`)

æŒ‰æ—¶é—´é—´éš”æˆ– Cron è¡¨è¾¾å¼è§¦å‘ï¼š

```json
{
  "type": "timer",
  "interval": 60000
}
```

æˆ–

```json
{
  "type": "timer",
  "cron": "0 * * * *"
}
```

#### 4.2.4 å¯åŠ¨è§¦å‘ (`startup`)

ç³»ç»Ÿå¯åŠ¨å®Œæˆåè§¦å‘ä¸€æ¬¡ï¼š

```json
{
  "type": "startup",
  "delay": 5000
}
```

### 4.3 æ¡ä»¶è¡¨è¾¾å¼è¯­æ³•

#### æ”¯æŒçš„è¿ç®—ç¬¦

| ç±»å‹ | è¿ç®—ç¬¦ | ç¤ºä¾‹ |
|------|--------|------|
| æ¯”è¾ƒ | `>`, `<`, `>=`, `<=`, `==`, `!=` | `agx.cpu_temp > 80` |
| é€»è¾‘ | `AND`, `OR`, `NOT` | `a > 1 AND b < 2` |
| æ‹¬å· | `(`, `)` | `(a > 1 OR b > 2) AND c == 0` |
| å­—ç¬¦ä¸² | `==`, `!=`, `contains` | `lpmu.status == "running"` |
| å­˜åœ¨æ€§ | `exists`, `!exists` | `exists(agx.cpu_temp)` |

#### å˜é‡å¼•ç”¨

```
${source_id.field_id}   # å®Œæ•´å¼•ç”¨
source_id.field_id      # ç®€å†™ï¼ˆæ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼‰
```

#### ç¤ºä¾‹

```
# ç®€å•æ¯”è¾ƒ
agx.cpu_temp > 80

# å¤åˆæ¡ä»¶
agx.cpu_temp > 80 AND agx.gpu_temp > 75

# èŒƒå›´åˆ¤æ–­
agx.cpu_temp >= 70 AND agx.cpu_temp < 85

# å­—ç¬¦ä¸²æ¯”è¾ƒ
lpmu.status == "running"

# å¸¦æ‹¬å·çš„å¤æ‚æ¡ä»¶
(agx.cpu_temp > 85 OR agx.gpu_temp > 85) AND esp32.power_monitor.voltage > 12

# å­˜åœ¨æ€§æ£€æŸ¥
exists(agx.cpu_temp) AND agx.cpu_temp > 80
```

---

## 5. åŠ¨ä½œç³»ç»Ÿ

### 5.1 åŠ¨ä½œæ¨¡æ¿ç³»ç»Ÿï¼ˆ2026-01-28 æ–°å¢ï¼‰

åŠ¨ä½œæ¨¡æ¿æ˜¯å¯å¤ç”¨çš„åŠ¨ä½œé…ç½®ï¼Œæ”¯æŒæ‰‹åŠ¨æ‰§è¡Œå’Œè§„åˆ™è§¦å‘ã€‚

#### 5.1.1 æ¨¡æ¿ç»“æ„

```json
{
  "id": "action_001",
  "name": "AGX é‡å¯å‘½ä»¤",
  "description": "å®‰å…¨é‡å¯ AGX Orin",
  "type": "ssh_cmd_ref",
  "enabled": true,
  "delay_ms": 0,
  "ssh_ref": {
    "cmd_id": "agx_reboot"
  }
}
```

#### 5.1.2 æ”¯æŒçš„åŠ¨ä½œç±»å‹

| ç±»å‹ | è¯´æ˜ | é…ç½®å‚æ•° |
|------|------|----------|
| `cli` | æœ¬åœ° CLI å‘½ä»¤ | `command`, `var_name`, `timeout_ms` |
| `ssh_cmd_ref` | SSH å‘½ä»¤å¼•ç”¨ | `cmd_id`ï¼ˆå¼•ç”¨å·²é…ç½®çš„ SSH å‘½ä»¤ï¼‰ |
| `led` | LED æ§åˆ¶ | `device`, `color`, `effect`, `brightness` |
| `log` | æ—¥å¿—è®°å½• | `level`, `message` |
| `set_var` | è®¾ç½®å˜é‡ | `variable`, `value` |
| `webhook` | HTTP è¯·æ±‚ | `url`, `method`, `body_template` |

#### 5.1.3 SSH å‘½ä»¤å¼•ç”¨æœºåˆ¶

åŠ¨ä½œæ¨¡æ¿é€šè¿‡ `cmd_id` å¼•ç”¨ SSH ç®¡ç†é¡µé¢ä¸­å·²é…ç½®çš„å‘½ä»¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SSH å‘½ä»¤é…ç½®       â”‚     â”‚  åŠ¨ä½œæ¨¡æ¿           â”‚     â”‚  æ‰§è¡Œæ—¶             â”‚
â”‚  (ts_ssh_commands)  â”‚â”€â”€â”€â”€â–¶â”‚  (ssh_cmd_ref)      â”‚â”€â”€â”€â”€â–¶â”‚  (ts_action_exec)   â”‚
â”‚                     â”‚     â”‚                     â”‚     â”‚                     â”‚
â”‚  id: agx_reboot     â”‚     â”‚  cmd_id: agx_reboot â”‚     â”‚  æŸ¥æ‰¾å‘½ä»¤é…ç½®       â”‚
â”‚  host: agx0         â”‚     â”‚                     â”‚     â”‚  è·å–ä¸»æœºä¿¡æ¯       â”‚
â”‚  command: reboot    â”‚     â”‚                     â”‚     â”‚  keystore è®¤è¯      â”‚
â”‚  var_name: result   â”‚     â”‚                     â”‚     â”‚  æ‰§è¡Œå¹¶å­˜å‚¨ç»“æœ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 5.1.4 NVS æŒä¹…åŒ–

åŠ¨ä½œæ¨¡æ¿è‡ªåŠ¨ä¿å­˜åˆ° NVSï¼ˆ`action_tpl` namespaceï¼‰ï¼š

```c
// åˆå§‹åŒ–æ—¶åŠ è½½
esp_err_t ts_action_manager_init(void) {
    // ... åˆå§‹åŒ– ...
    ts_action_templates_load();  // ä» NVS æ¢å¤
}

// ä¿®æ”¹æ—¶è‡ªåŠ¨ä¿å­˜
esp_err_t ts_action_template_add(...) {
    // ... æ·»åŠ  ...
    ts_action_templates_save();  // æŒä¹…åŒ–åˆ° NVS
}
```

#### 5.1.5 API ç«¯ç‚¹

| ç«¯ç‚¹ | è¯´æ˜ |
|------|------|
| `automation.actions.list` | åˆ—å‡ºæ‰€æœ‰åŠ¨ä½œæ¨¡æ¿ |
| `automation.actions.add` | åˆ›å»ºæ¨¡æ¿ |
| `automation.actions.get` | è·å–æ¨¡æ¿è¯¦æƒ… |
| `automation.actions.delete` | åˆ é™¤æ¨¡æ¿ |
| `automation.actions.execute` | æ‰§è¡Œæ¨¡æ¿ |

### 5.2 åŠ¨ä½œç±»å‹æ¦‚è§ˆ

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `led.touch` | Touch å±å¹•æ˜¾ç¤º | æ˜¾ç¤ºæ–‡å­—ã€æ•°å€¼ |
| `led.board` | æ¿è½½ LED | çŠ¶æ€é¢œè‰²ã€é—ªçƒ |
| `led.matrix` | çŸ©é˜µå±æ˜¾ç¤º | æ•ˆæœã€åŠ¨ç”»ã€æ–‡å­— |
| `ssh` | SSH å‘½ä»¤æ‰§è¡Œ | è¿œç¨‹æ§åˆ¶å‘½ä»¤ |
| `gpio` | GPIO æ§åˆ¶ | ç”µå¹³è®¾ç½® |
| `log` | æ—¥å¿—è®°å½• | è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿— |
| `variable` | å˜é‡æ“ä½œ | è®¾ç½®/æ¸…é™¤å˜é‡ |
| `delay` | å»¶æ—¶ | ç­‰å¾…æŒ‡å®šæ—¶é—´ |
| `trigger_rule` | è§¦å‘è§„åˆ™ | é“¾å¼è§¦å‘å…¶ä»–è§„åˆ™ |
| `conditional` | æ¡ä»¶åŠ¨ä½œ | æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒåŠ¨ä½œ |

### 5.2 LED åŠ¨ä½œ

#### 5.2.1 Touch æ˜¾ç¤º (`led.touch`)

```json
{
  "type": "led.touch",
  "mode": "text",
  "content": "CPU: ${agx.cpu_temp}Â°C\nGPU: ${agx.gpu_temp}Â°C",
  "font_size": 16,
  "color": "#FFFFFF",
  "background": "#000000",
  "duration": 0,
  "page": 0
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `mode` | æ˜¾ç¤ºæ¨¡å¼: `text`, `value`, `chart` | `text` |
| `content` | æ˜¾ç¤ºå†…å®¹ï¼Œæ”¯æŒå˜é‡æ›¿æ¢å’Œ `\n` æ¢è¡Œ | å¿…å¡« |
| `font_size` | å­—ä½“å¤§å° | 16 |
| `color` | æ–‡å­—é¢œè‰² | `#FFFFFF` |
| `background` | èƒŒæ™¯é¢œè‰² | `#000000` |
| `duration` | æ˜¾ç¤ºæŒç»­æ—¶é—´ (ms)ï¼Œ0 = æŒç»­æ˜¾ç¤º | 0 |
| `page` | æ˜¾ç¤ºé¡µé¢ç¼–å· | 0 |

#### 5.2.2 Board LED (`led.board`)

```json
{
  "type": "led.board",
  "color": "#FF0000",
  "blink": true,
  "blink_interval": 500,
  "duration": 5000
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `color` | LED é¢œè‰² (åå…­è¿›åˆ¶æˆ–å‘½åé¢œè‰²) | å¿…å¡« |
| `blink` | æ˜¯å¦é—ªçƒ | false |
| `blink_interval` | é—ªçƒé—´éš” (ms) | 500 |
| `duration` | æŒç»­æ—¶é—´ (ms)ï¼Œ0 = æŒç»­ | 0 |

#### 5.2.3 Matrix æ˜¾ç¤º (`led.matrix`)

```json
{
  "type": "led.matrix",
  "effect": "alert",
  "params": {
    "color": "red",
    "text": "OVERHEAT",
    "speed": 50
  },
  "duration": 0
}
```

**æ”¯æŒçš„æ•ˆæœ**:

| effect | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| `solid` | çº¯è‰² | `color` |
| `alert` | è­¦æŠ¥æ•ˆæœ | `color`, `text` |
| `pulse` | å‘¼å¸æ•ˆæœ | `color`, `speed` |
| `scroll` | æ»šåŠ¨æ–‡å­— | `text`, `color`, `speed` |
| `value` | æ•°å€¼æ˜¾ç¤º | `source`, `format`, `color` |
| `progress` | è¿›åº¦æ¡ | `value`, `max`, `color` |
| `custom` | è‡ªå®šä¹‰å›¾æ¡ˆ | `pattern` (æ•°ç»„) |

### 5.3 SSH åŠ¨ä½œ

```json
{
  "type": "ssh",
  "host": "agx_ssh",
  "command": "sudo jetson_clocks --fan",
  "timeout": 30000,
  "async": false,
  "store_result": "fan_result",
  "on_success": [...],
  "on_failure": [...]
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `host` | SSH ä¸»æœº ID (åœ¨ ssh_hosts ä¸­å®šä¹‰) | å¿…å¡« |
| `command` | è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ | å¿…å¡« |
| `timeout` | è¶…æ—¶æ—¶é—´ (ms) | 30000 |
| `async` | æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ | false |
| `store_result` | å­˜å‚¨ç»“æœçš„å˜é‡å | - |
| `on_success` | æˆåŠŸæ—¶æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨ | - |
| `on_failure` | å¤±è´¥æ—¶æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨ | - |

**ç»“æœå˜é‡** (å½“ `store_result` è®¾ç½®æ—¶):

```
${fan_result.exit_code}   # é€€å‡ºç 
${fan_result.stdout}      # æ ‡å‡†è¾“å‡º
${fan_result.stderr}      # æ ‡å‡†é”™è¯¯
${fan_result.duration}    # æ‰§è¡Œæ—¶é—´ (ms)
```

### 5.4 æ¡ä»¶åŠ¨ä½œ (`conditional`)

æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„åŠ¨ä½œï¼š

```json
{
  "type": "conditional",
  "conditions": [
    {
      "if": "ssh.last.exit_code == 0",
      "then": [
        {"type": "led.touch", "content": "âœ“ å‘½ä»¤æˆåŠŸ"}
      ]
    },
    {
      "if": "ssh.last.exit_code != 0",
      "then": [
        {"type": "led.touch", "content": "âœ— å‘½ä»¤å¤±è´¥: ${ssh.last.stderr}"},
        {"type": "led.board", "color": "#FF0000", "blink": true}
      ]
    }
  ],
  "else": [
    {"type": "log", "message": "æœªåŒ¹é…ä»»ä½•æ¡ä»¶"}
  ]
}
```

### 5.5 å…¶ä»–åŠ¨ä½œ

#### æ—¥å¿— (`log`)

```json
{
  "type": "log",
  "level": "warn",
  "message": "æ¸©åº¦è¿‡é«˜: CPU=${agx.cpu_temp}Â°C GPU=${agx.gpu_temp}Â°C"
}
```

#### å˜é‡è®¾ç½® (`variable`)

```json
{
  "type": "variable",
  "action": "set",
  "name": "alert_count",
  "value": "${alert_count} + 1"
}
```

#### å»¶æ—¶ (`delay`)

```json
{
  "type": "delay",
  "ms": 5000
}
```

#### è§¦å‘è§„åˆ™ (`trigger_rule`)

```json
{
  "type": "trigger_rule",
  "rule_id": "recovery_procedure"
}
```

---

## 6. é…ç½® Schema

### 6.1 å®Œæ•´é…ç½®ç»“æ„

```json
{
  "version": "1.0",
  "sources": [...],
  "ssh_hosts": [...],
  "rules": [...],
  "commands": [...],
  "displays": {...},
  "secrets": {...}
}
```

### 6.2 å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "version": "1.0",
  
  "sources": [
    {
      "id": "esp32",
      "name": "ESP32 æœ¬æœº",
      "type": "builtin",
      "interval": 1000,
      "fields": [
        {"id": "heap_free", "builtin": "system.heap_free", "name": "å¯ç”¨å†…å­˜"},
        {"id": "voltage", "builtin": "adc.voltage_main", "name": "ä¸»ç”µå‹"},
        {"id": "wifi_rssi", "builtin": "network.wifi_rssi", "name": "WiFiä¿¡å·"}
      ]
    },
    {
      "id": "agx",
      "name": "AGX Orin",
      "type": "websocket",
      "config": {
        "url": "ws://192.168.1.100:58090/socket.io/",
        "reconnect": true
      },
      "interval": 1000,
      "enabled": true,
      "fields": [
        {"id": "cpu_temp", "path": "cpu.temp", "name": "CPUæ¸©åº¦", "unit": "Â°C"},
        {"id": "gpu_temp", "path": "gpu.temp", "name": "GPUæ¸©åº¦", "unit": "Â°C"},
        {"id": "gpu_usage", "path": "gpu.percent", "name": "GPUä½¿ç”¨ç‡", "unit": "%"},
        {"id": "power", "path": "power.watts", "name": "åŠŸè€—", "unit": "W"}
      ]
    },
    {
      "id": "lpmu",
      "name": "LPMU æœåŠ¡å™¨",
      "type": "rest",
      "config": {
        "url": "http://192.168.1.101:8080/api/status",
        "method": "GET"
      },
      "interval": 5000,
      "enabled": true,
      "fields": [
        {"id": "status", "path": "status", "name": "è¿è¡ŒçŠ¶æ€"},
        {"id": "fps", "path": "inference.fps", "name": "æ¨ç†FPS"}
      ]
    }
  ],
  
  "ssh_hosts": [
    {
      "id": "agx_ssh",
      "name": "AGX Orin",
      "host": "192.168.1.100",
      "port": 22,
      "username": "nvidia",
      "auth": "key",
      "key_path": "/sdcard/ssh/agx_key"
    },
    {
      "id": "lpmu_ssh",
      "name": "LPMU",
      "host": "192.168.1.101",
      "port": 22,
      "username": "admin",
      "auth": "password",
      "password_key": "lpmu_password"
    }
  ],
  
  "rules": [
    {
      "id": "normal_display",
      "name": "æ­£å¸¸çŠ¶æ€æ˜¾ç¤º",
      "enabled": true,
      "trigger": {
        "type": "condition",
        "expression": "agx.cpu_temp <= 85 AND agx.gpu_temp <= 85"
      },
      "actions": [
        {
          "type": "led.touch",
          "content": "GPU ${agx.gpu_usage}%\n${agx.gpu_temp}Â°C"
        },
        {
          "type": "led.board",
          "color": "#00FF00"
        },
        {
          "type": "led.matrix",
          "effect": "value",
          "params": {"source": "agx.gpu_usage", "color": "gradient"}
        }
      ]
    },
    {
      "id": "high_temp_alert",
      "name": "é«˜æ¸©è­¦æŠ¥",
      "enabled": true,
      "priority": 10,
      "trigger": {
        "type": "condition",
        "expression": "agx.cpu_temp > 85 OR agx.gpu_temp > 85",
        "debounce": 3000
      },
      "actions": [
        {
          "type": "led.matrix",
          "effect": "alert",
          "params": {"color": "red", "text": "OVERHEAT"}
        },
        {
          "type": "led.board",
          "color": "#FF0000",
          "blink": true
        },
        {
          "type": "ssh",
          "host": "agx_ssh",
          "command": "sudo jetson_clocks --fan"
        },
        {
          "type": "log",
          "level": "warn",
          "message": "é«˜æ¸©è­¦æŠ¥: CPU=${agx.cpu_temp}Â°C GPU=${agx.gpu_temp}Â°C"
        }
      ]
    },
    {
      "id": "low_voltage_protection",
      "name": "ä½ç”µå‹ä¿æŠ¤",
      "enabled": true,
      "priority": 100,
      "trigger": {
        "type": "condition",
        "expression": "esp32.voltage < 11.5",
        "sustain": 10000
      },
      "actions": [
        {
          "type": "led.matrix",
          "effect": "alert",
          "params": {"color": "red", "text": "LOW POWER"}
        },
        {
          "type": "ssh",
          "host": "agx_ssh",
          "command": "sudo shutdown -h now",
          "async": true
        },
        {
          "type": "ssh",
          "host": "lpmu_ssh",
          "command": "sudo shutdown -h now",
          "async": true
        },
        {
          "type": "log",
          "level": "error",
          "message": "ä½ç”µå‹ä¿æŠ¤è§¦å‘: ${esp32.voltage}V"
        }
      ]
    },
    {
      "id": "ssh_feedback",
      "name": "SSH æ‰§è¡Œåé¦ˆ",
      "enabled": true,
      "trigger": {
        "type": "event",
        "event": "ssh.completed"
      },
      "actions": [
        {
          "type": "conditional",
          "conditions": [
            {
              "if": "ssh.last.exit_code == 0",
              "then": [
                {"type": "led.touch", "content": "âœ“ å‘½ä»¤æˆåŠŸ", "duration": 3000}
              ]
            },
            {
              "if": "ssh.last.exit_code != 0",
              "then": [
                {"type": "led.touch", "content": "âœ— å¤±è´¥", "duration": 5000},
                {"type": "led.board", "color": "#FF0000", "duration": 3000}
              ]
            }
          ]
        }
      ]
    }
  ],
  
  "commands": [
    {
      "id": "reboot_agx",
      "name": "é‡å¯ AGX",
      "icon": "restart",
      "category": "power",
      "host": "agx_ssh",
      "command": "sudo reboot",
      "confirm": "ç¡®å®šè¦é‡å¯ AGX å—ï¼Ÿ",
      "require_role": "operator"
    },
    {
      "id": "fan_max",
      "name": "é£æ‰‡å…¨é€Ÿ",
      "icon": "fan",
      "category": "cooling",
      "host": "agx_ssh",
      "command": "sudo jetson_clocks --fan"
    },
    {
      "id": "check_gpu",
      "name": "GPU çŠ¶æ€",
      "icon": "gpu",
      "category": "info",
      "host": "agx_ssh",
      "command": "nvidia-smi --query-gpu=temperature.gpu,utilization.gpu --format=csv,noheader",
      "show_output": true
    },
    {
      "id": "restart_inference",
      "name": "é‡å¯æ¨ç†æœåŠ¡",
      "icon": "refresh",
      "category": "service",
      "host": "lpmu_ssh",
      "command": "sudo systemctl restart inference.service"
    }
  ],
  
  "displays": {
    "default_page_interval": 5000,
    "brightness": 80
  },
  
  "secrets": {
    "storage": "nvs",
    "keys": ["lpmu_password", "lpmu_token"]
  }
}
```

### 6.3 é…ç½®æ–‡ä»¶ä½ç½®

| ä½ç½® | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| `/sdcard/config/automation.json` | 1 (æœ€é«˜) | SD å¡é…ç½®ï¼Œå¯çƒ­æ›´æ–° |
| NVS `automation` | 2 | æŒä¹…åŒ–é…ç½® |
| å†…ç½®é»˜è®¤é…ç½® | 3 | ç¼–è¯‘æ—¶é»˜è®¤å€¼ |

---

## 7. WebUI Dashboard è®¾è®¡

> **é‡è¦**: Dashboard æ˜¯ WebUI çš„æ ¸å¿ƒç•Œé¢ï¼Œ**æ‰€æœ‰é…ç½®éƒ½åœ¨å‰ç«¯å®šä¹‰**ï¼Œå¯å¯¼å‡ºä¸º JSONã€‚
> 
> **å¯¼èˆªæ å˜æ›´**: åˆ é™¤åŸæœ‰çš„"ç›‘æ§"ã€"é…ç½®"é¡µé¢ï¼Œåˆå¹¶ä¸ºç»Ÿä¸€çš„ **Dashboard** å…¥å£ã€‚

### 7.1 å¯¼èˆªæ ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â›°ï¸ TianShanOS                                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [Dashboard] [ç½‘ç»œ] [æ–‡ä»¶] [ç»ˆç«¯] [å®‰å…¨] [ç³»ç»Ÿ]         ğŸ”Œ å·²è¿æ¥  ğŸ‘¤ admin  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é¡µé¢è¯´æ˜**:
- **Dashboard** (æ–°): ç»Ÿä¸€çš„ç›‘æ§ã€æ§åˆ¶ã€è‡ªåŠ¨åŒ–é…ç½®ç•Œé¢ â­
- **ç½‘ç»œ**: ç½‘ç»œé…ç½®ï¼ˆWiFi/ä»¥å¤ªç½‘/NATï¼‰
- **æ–‡ä»¶**: SD å¡æ–‡ä»¶ç®¡ç†
- **ç»ˆç«¯**: ä¸²å£ç»ˆç«¯ + æ—¥å¿—æŸ¥çœ‹
- **å®‰å…¨**: PKI è¯ä¹¦ã€SSH å¯†é’¥ç®¡ç†
- **ç³»ç»Ÿ**: ç³»ç»Ÿä¿¡æ¯ã€OTA æ›´æ–°ã€é‡å¯

### 7.2 Dashboard ä¸»ç•Œé¢

Dashboard é‡‡ç”¨**å¯é…ç½®çš„å¡ç‰‡å¸ƒå±€**ï¼Œç”¨æˆ·å¯ä»¥ï¼š
- æ·»åŠ /åˆ é™¤/æ‹–æ‹½å¡ç‰‡
- è‡ªå®šä¹‰å¡ç‰‡æ˜¾ç¤ºå†…å®¹
- é…ç½®æ•°æ®æºå’Œè§„åˆ™
- å®æ—¶é¢„è§ˆæ•ˆæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard                                    [ç¼–è¾‘æ¨¡å¼] [å¯¼å‡ºJSON] [å¯¼å…¥]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“Š AGX çŠ¶æ€             â”‚  â”‚ ğŸ“Š LPMU çŠ¶æ€            â”‚  â”‚ ğŸ”‹ ç”µæº     â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚ CPU: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 78%    â”‚  â”‚ çŠ¶æ€: ğŸŸ¢ è¿è¡Œä¸­         â”‚  â”‚ 12.8V     â”‚  â”‚
â”‚  â”‚ GPU: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 95%    â”‚  â”‚ FPS:  45               â”‚  â”‚ 2.1A      â”‚  â”‚
â”‚  â”‚ æ¸©åº¦: CPU 72Â°C GPU 80Â°C â”‚  â”‚ æ¨¡å‹: YOLOv8           â”‚  â”‚ 26.9W     â”‚  â”‚
â”‚  â”‚ åŠŸè€—: 45W              â”‚  â”‚ é˜Ÿåˆ—: 3                â”‚  â”‚           â”‚  â”‚
â”‚  â”‚ [è¯¦æƒ…] [SSHç»ˆç«¯]       â”‚  â”‚ [è¯¦æƒ…] [SSHç»ˆç«¯]       â”‚  â”‚ [å†å²]    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ® å¿«æ·å‘½ä»¤             â”‚  â”‚ ğŸ“‹ è‡ªåŠ¨åŒ–è§„åˆ™                           â”‚  â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚  â”‚ â— æ­£å¸¸æ˜¾ç¤º      æ¡ä»¶: temp <= 85       â”‚  â”‚
â”‚  â”‚ â”‚é‡å¯  â”‚â”‚å…³æœº  â”‚â”‚é£æ‰‡  â”‚â”‚  â”‚ â—‹ é«˜æ¸©è­¦æŠ¥      æ¡ä»¶: temp > 85        â”‚  â”‚
â”‚  â”‚ â”‚ AGX â”‚â”‚ AGX â”‚â”‚å…¨é€Ÿ  â”‚â”‚  â”‚ â—‹ ä½ç”µå‹ä¿æŠ¤    æ¡ä»¶: voltage < 11.5   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚  â”‚ â—‹ SSHåé¦ˆ       äº‹ä»¶: ssh.completed    â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”â”‚  â”‚                                         â”‚  â”‚
â”‚  â”‚ â”‚é‡å¯  â”‚â”‚GPU   â”‚â”‚è‡ªå®šä¹‰â”‚â”‚  â”‚ [+ æ·»åŠ è§„åˆ™] [ç¼–è¾‘è§„åˆ™]                  â”‚  â”‚
â”‚  â”‚ â”‚LPMU â”‚â”‚çŠ¶æ€  â”‚â”‚å‘½ä»¤  â”‚â”‚  â”‚                                         â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ’¡ LED æ˜¾ç¤ºé¢„è§ˆ                                                      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  Touch          Board           Matrix                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚GPU: 95%  â”‚   â”‚ ğŸŸ¢ â”‚         â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚ 80Â°C     â”‚   â””â”€â”€â”€â”€â”˜         â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  GPU: 95%  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  â”‚   â”‚   â”‚
â”‚  â”‚  [é…ç½®Touch]   [é…ç½®Board]     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                [é…ç½®Matrix]                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 ç¼–è¾‘æ¨¡å¼

ç‚¹å‡» **[ç¼–è¾‘æ¨¡å¼]** åï¼Œè¿›å…¥é…ç½®ç•Œé¢ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Dashboard é…ç½®                                   [é¢„è§ˆ] [ä¿å­˜] [å–æ¶ˆ]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  å·¦ä¾§é¢æ¿                              å³ä¾§ç¼–è¾‘åŒº                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“‚ æ•°æ®æº       â”‚                  â”‚ ç¼–è¾‘æ•°æ®æº: AGX Orin            â”‚  â”‚
â”‚  â”‚   â”œâ”€ ESP32 å†…ç½® â”‚                  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚   â”œâ”€ AGX (WS)  â—„â”‚ â† é€‰ä¸­          â”‚ åç§°:    [AGX Orin           ]  â”‚  â”‚
â”‚  â”‚   â””â”€ LPMU (REST)â”‚                  â”‚ ç±»å‹:    [WebSocket â–¼]          â”‚  â”‚
â”‚  â”‚ [+ æ·»åŠ ]        â”‚                  â”‚ URL:     [ws://192.168.1.100..] â”‚  â”‚
â”‚  â”‚                 â”‚                  â”‚ é—´éš”:    [1000] ms              â”‚  â”‚
â”‚  â”‚ ğŸ“‚ SSH ä¸»æœº     â”‚                  â”‚ å¯ç”¨:    [âœ“]                    â”‚  â”‚
â”‚  â”‚   â”œâ”€ agx_ssh    â”‚                  â”‚                                 â”‚  â”‚
â”‚  â”‚   â””â”€ lpmu_ssh   â”‚                  â”‚ æ•°æ®å­—æ®µ:                        â”‚  â”‚
â”‚  â”‚ [+ æ·»åŠ ]        â”‚                  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚                 â”‚                  â”‚ â”‚ cpu_temp | cpu.temp | Â°C   â”‚ â”‚  â”‚
â”‚  â”‚ ğŸ“‚ è§„åˆ™        â”‚                  â”‚ â”‚ gpu_temp | gpu.temp | Â°C   â”‚ â”‚  â”‚
â”‚  â”‚   â”œâ”€ æ­£å¸¸æ˜¾ç¤º   â”‚                  â”‚ â”‚ gpu_usage| gpu.percent| %  â”‚ â”‚  â”‚
â”‚  â”‚   â”œâ”€ é«˜æ¸©è­¦æŠ¥   â”‚                  â”‚ â”‚ [+ æ·»åŠ å­—æ®µ]                â”‚ â”‚  â”‚
â”‚  â”‚   â””â”€ ä½ç”µå‹ä¿æŠ¤ â”‚                  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ [+ æ·»åŠ ]        â”‚                  â”‚                                 â”‚  â”‚
â”‚  â”‚                 â”‚                  â”‚ [æµ‹è¯•è¿æ¥]  [åˆ é™¤æ•°æ®æº]        â”‚  â”‚
â”‚  â”‚ ğŸ“‚ å¿«æ·å‘½ä»¤     â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚   â”œâ”€ é‡å¯AGX    â”‚                                                       â”‚
â”‚  â”‚   â”œâ”€ é£æ‰‡å…¨é€Ÿ   â”‚                                                       â”‚
â”‚  â”‚   â””â”€ ...        â”‚                                                       â”‚
â”‚  â”‚ [+ æ·»åŠ ]        â”‚                                                       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.4 è§„åˆ™ç¼–è¾‘å™¨ (å¯è§†åŒ–)

```
â”Œâ”€ ç¼–è¾‘è§„åˆ™: é«˜æ¸©è­¦æŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  åŸºæœ¬ä¿¡æ¯                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è§„åˆ™ID:  [high_temp_alert    ]    ä¼˜å…ˆçº§: [10   ]    å¯ç”¨: [âœ“]      â”‚   â”‚
â”‚  â”‚ åç§°:    [é«˜æ¸©è­¦æŠ¥                                              ]   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  è§¦å‘æ¡ä»¶                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç±»å‹: [â—‰ æ¡ä»¶è§¦å‘  â—‹ äº‹ä»¶è§¦å‘  â—‹ å®šæ—¶è§¦å‘]                          â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ æ¡ä»¶æ„å»ºå™¨ (å¯è§†åŒ–):                                                 â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ [agx.cpu_temp â–¼]  [>  â–¼]  [85    ]                              â”‚ â”‚   â”‚
â”‚  â”‚ â”‚                                                    [OR â–¼] [âœ•]   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ [agx.gpu_temp â–¼]  [>  â–¼]  [85    ]                        [âœ•]   â”‚ â”‚   â”‚
â”‚  â”‚ â”‚                                                                 â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ [+ æ·»åŠ æ¡ä»¶]                                                    â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ æˆ–æ‰‹åŠ¨è¾“å…¥è¡¨è¾¾å¼:                                                    â”‚   â”‚
â”‚  â”‚ [agx.cpu_temp > 85 OR agx.gpu_temp > 85                          ] â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ é«˜çº§é€‰é¡¹:  é˜²æŠ– [3000] ms    æŒç»­ [0   ] ms                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  æ‰§è¡ŒåŠ¨ä½œ                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. LED Matrix                                              [â†‘â†“] [âœ•] â”‚   â”‚
â”‚  â”‚    æ•ˆæœ: [alert â–¼]  é¢œè‰²: [ğŸ”´ red]  æ–‡å­—: [OVERHEAT        ]       â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚ 2. LED Board                                               [â†‘â†“] [âœ•] â”‚   â”‚
â”‚  â”‚    é¢œè‰²: [#FF0000  ğŸ¨]  é—ªçƒ: [âœ“]  é—´éš”: [500] ms                  â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚ 3. SSH å‘½ä»¤                                                [â†‘â†“] [âœ•] â”‚   â”‚
â”‚  â”‚    ä¸»æœº: [agx_ssh â–¼]  å‘½ä»¤: [sudo jetson_clocks --fan       ]      â”‚   â”‚
â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚ 4. æ—¥å¿—                                                    [â†‘â†“] [âœ•] â”‚   â”‚
â”‚  â”‚    çº§åˆ«: [warn â–¼]  æ¶ˆæ¯: [é«˜æ¸©è­¦æŠ¥: CPU=${agx.cpu_temp}Â°C...]      â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ [+ æ·»åŠ åŠ¨ä½œ â–¼]                                                      â”‚   â”‚
â”‚  â”‚   â”œâ”€ LED Touch                                                      â”‚   â”‚
â”‚  â”‚   â”œâ”€ LED Board                                                      â”‚   â”‚
â”‚  â”‚   â”œâ”€ LED Matrix                                                     â”‚   â”‚
â”‚  â”‚   â”œâ”€ SSH å‘½ä»¤                                                       â”‚   â”‚
â”‚  â”‚   â”œâ”€ æ—¥å¿—                                                           â”‚   â”‚
â”‚  â”‚   â”œâ”€ å»¶æ—¶                                                           â”‚   â”‚
â”‚  â”‚   â””â”€ è§¦å‘å…¶ä»–è§„åˆ™                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚                                     [æµ‹è¯•è§„åˆ™] [åˆ é™¤è§„åˆ™] [å–æ¶ˆ] [ä¿å­˜]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.5 å®æ—¶ç›‘æ§é¢æ¿

```
â”Œâ”€ å®æ—¶ç›‘æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  æ•°æ®æºçŠ¶æ€                              å½“å‰å˜é‡å€¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“Ÿ ESP32   âœ… è¿è¡Œ   1.0s   â”‚       â”‚ ğŸ” ç­›é€‰: [              ] ğŸ”   â”‚  â”‚
â”‚  â”‚ ğŸ–¥ï¸ AGX     âœ… è¿æ¥   1.0s   â”‚       â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚
â”‚  â”‚ ğŸ–¥ï¸ LPMU    âš ï¸ è¶…æ—¶   5.0s   â”‚       â”‚ esp32.heap_free     = 156 KB   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ esp32.power.voltage = 12.8 V   â”‚  â”‚
â”‚                                        â”‚ agx.cpu_temp        = 67 Â°C    â”‚  â”‚
â”‚  è§„åˆ™çŠ¶æ€                               â”‚ agx.gpu_temp        = 72 Â°C    â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚ agx.gpu_usage       = 45 %     â”‚  â”‚
â”‚  â”‚ ğŸŸ¢ æ­£å¸¸çŠ¶æ€æ˜¾ç¤º  â— æ¿€æ´»ä¸­   â”‚       â”‚ lpmu.status         = (è¶…æ—¶)   â”‚  â”‚
â”‚  â”‚ âšª é«˜æ¸©è­¦æŠ¥      â—‹ å¾…å‘½     â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ âšª ä½ç”µå‹ä¿æŠ¤    â—‹ å¾…å‘½     â”‚                                           â”‚  â”‚
â”‚  â”‚ â­• SSHåé¦ˆ       â—‹ ç¦ç”¨     â”‚       æœ€è¿‘åŠ¨ä½œæ—¥å¿—                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                                        â”‚ 12:34:56 [LED] touch æ›´æ–°æ˜¾ç¤º  â”‚  â”‚
â”‚                                        â”‚ 12:34:55 [LED] matrix æ›´æ–°æ•ˆæœ â”‚  â”‚
â”‚                                        â”‚ 12:34:50 [SSH] agx æ‰§è¡Œå®Œæˆ âœ“  â”‚  â”‚
â”‚                                        â”‚ 12:34:45 [è§„åˆ™] æ­£å¸¸æ˜¾ç¤º è§¦å‘  â”‚  â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.6 é…ç½®å¯¼å‡º/å¯¼å…¥

Dashboard é…ç½®å¯å®Œæ•´å¯¼å‡ºä¸º JSON æ–‡ä»¶ï¼š

```json
{
  "version": "1.0",
  "dashboard": {
    "layout": "grid",
    "cards": [
      {"id": "agx_status", "type": "device_status", "source": "agx", "position": {"x": 0, "y": 0}},
      {"id": "lpmu_status", "type": "device_status", "source": "lpmu", "position": {"x": 1, "y": 0}},
      {"id": "power_card", "type": "power_monitor", "position": {"x": 2, "y": 0}},
      {"id": "commands", "type": "command_panel", "position": {"x": 0, "y": 1}},
      {"id": "rules", "type": "rule_list", "position": {"x": 1, "y": 1, "width": 2}},
      {"id": "led_preview", "type": "led_preview", "position": {"x": 0, "y": 2, "width": 3}}
    ]
  },
  "sources": [...],
  "ssh_hosts": [...],
  "rules": [...],
  "commands": [...]
}
```

---

## 8. ç»„ä»¶è®¾è®¡

### 8.1 ç»„ä»¶åˆ—è¡¨

| ç»„ä»¶ | è·¯å¾„ | èŒè´£ | çŠ¶æ€ |
|------|------|------|------|
| `ts_automation` | `components/ts_automation/` | æ ¸å¿ƒå¼•æ“ï¼šé…ç½®åŠ è½½ã€è°ƒåº¦åè°ƒã€**å˜é‡å­˜å‚¨** | âœ… å·²å®ç° |
| `ts_source_manager` | `components/ts_automation/src/` | æ•°æ®æºç®¡ç†ï¼šå†…ç½®/WS/REST/SSH é‡‡é›† | âœ… å·²å®ç° |
| `ts_rule_engine` | `components/ts_automation/src/` | è§„åˆ™å¼•æ“ï¼šæ¡ä»¶è§£æã€è¡¨è¾¾å¼æ±‚å€¼ | âœ… å·²å®ç° |
| `ts_action_manager` | `components/ts_automation/src/` | åŠ¨ä½œæ‰§è¡Œï¼šç»Ÿä¸€åŠ¨ä½œæ¥å£ | âœ… å·²å®ç° |
| `ts_variable` | `components/ts_automation/src/` | å˜é‡å­˜å‚¨ï¼šç»Ÿä¸€æ•°æ®ç‚¹ç®¡ç†ã€å˜é‡å¼•ç”¨ | âœ… å·²å®ç° |

### 8.2 ç»„ä»¶ä¾èµ–

```
ts_automation (æ ¸å¿ƒå¼•æ“)
    â”œâ”€â”€ ts_source_manager (æ•°æ®æºç®¡ç†)
    â”‚   â”œâ”€â”€ ts_net (WS/HTTP å®¢æˆ·ç«¯)
    â”‚   â”œâ”€â”€ ts_security (SSH)
    â”‚   â””â”€â”€ ts_variable (å˜é‡å­˜å‚¨) âœ…
    â”œâ”€â”€ ts_rule_engine (è§„åˆ™å¼•æ“)
    â”‚   â””â”€â”€ ts_variable âœ…
    â”œâ”€â”€ ts_action_manager (åŠ¨ä½œæ‰§è¡Œ)
    â”‚   â”œâ”€â”€ ts_led (LED API)
    â”‚   â”œâ”€â”€ ts_security (SSH)
    â”‚   â””â”€â”€ ts_variable âœ…
    â””â”€â”€ ts_storage (é…ç½®æŒä¹…åŒ–)
```

> **æ³¨æ„**ï¼š`ts_var` ç»„ä»¶å·²åºŸå¼ƒï¼ˆ2026-01-27ï¼‰ï¼Œå˜é‡ç³»ç»Ÿç»Ÿä¸€ä½¿ç”¨ `ts_variable`ï¼ˆä½äº `ts_automation` ç»„ä»¶å†…ï¼‰ã€‚

### 8.3 æ ¸å¿ƒ API è®¾è®¡

#### ts_automation.h

```c
/**
 * @brief åˆå§‹åŒ–è‡ªåŠ¨åŒ–å¼•æ“
 * @param config_path é…ç½®æ–‡ä»¶è·¯å¾„ï¼ŒNULL ä½¿ç”¨é»˜è®¤è·¯å¾„
 * @return ESP_OK æˆåŠŸ
 */
esp_err_t ts_automation_init(const char *config_path);

/**
 * @brief å¯åŠ¨è‡ªåŠ¨åŒ–å¼•æ“
 */
esp_err_t ts_automation_start(void);

/**
 * @brief åœæ­¢è‡ªåŠ¨åŒ–å¼•æ“
 */
esp_err_t ts_automation_stop(void);

/**
 * @brief é‡æ–°åŠ è½½é…ç½®
 */
esp_err_t ts_automation_reload(void);

/**
 * @brief è·å–å¼•æ“çŠ¶æ€
 */
ts_automation_status_t ts_automation_get_status(void);
```

#### ts_source.h

```c
/**
 * @brief æ³¨å†Œæ•°æ®æº
 */
esp_err_t ts_source_register(const ts_source_config_t *config);

/**
 * @brief è·å–å˜é‡å€¼
 * @param source_id æ•°æ®æº ID
 * @param field_id å­—æ®µ ID
 * @param value è¾“å‡ºå€¼
 */
esp_err_t ts_source_get_value(const char *source_id, const char *field_id, 
                               ts_value_t *value);

/**
 * @brief æ³¨å†Œå†…ç½®æ•°æ®æä¾›è€…
 */
esp_err_t ts_source_register_builtin(const char *builtin_id, 
                                      ts_builtin_provider_fn provider);
```

#### ts_rule.h

```c
/**
 * @brief æ³¨å†Œè§„åˆ™
 */
esp_err_t ts_rule_register(const ts_rule_config_t *config);

/**
 * @brief å¯ç”¨/ç¦ç”¨è§„åˆ™
 */
esp_err_t ts_rule_set_enabled(const char *rule_id, bool enabled);

/**
 * @brief æ‰‹åŠ¨è§¦å‘è§„åˆ™ï¼ˆæµ‹è¯•ç”¨ï¼‰
 */
esp_err_t ts_rule_trigger(const char *rule_id);
```

#### ts_action.h

```c
/**
 * @brief æ³¨å†ŒåŠ¨ä½œæ‰§è¡Œå™¨
 */
esp_err_t ts_action_register(const char *type, ts_action_handler_fn handler);

/**
 * @brief æ‰§è¡ŒåŠ¨ä½œ
 */
esp_err_t ts_action_execute(const ts_action_t *action);
```

### 8.4 ts_variable ç»Ÿä¸€å˜é‡ç³»ç»Ÿï¼ˆâœ… å·²å®ç°ï¼‰

`ts_variable` æ˜¯è‡ªåŠ¨åŒ–å¼•æ“çš„**å”¯ä¸€**å˜é‡å­˜å‚¨å±‚ï¼Œæä¾›ç±»å‹å®‰å…¨çš„æ•°æ®ç‚¹ç®¡ç†å’Œå˜é‡å¼•ç”¨åŠŸèƒ½ã€‚

> **å†å²å˜æ›´**ï¼šåŸ `ts_var` ç»„ä»¶å·²äº 2026-01-27 åºŸå¼ƒå¹¶åˆ é™¤ï¼Œæ‰€æœ‰åŠŸèƒ½ç»Ÿä¸€åˆ° `ts_variable`ã€‚

#### ç»„ä»¶è·¯å¾„

```
components/ts_automation/
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ include/
â”‚   â””â”€â”€ ts_variable.h     # ç»Ÿä¸€å˜é‡ API
â””â”€â”€ src/
    â””â”€â”€ ts_variable.c     # å®ç°ï¼ˆPSRAM åˆ†é…ã€ç±»å‹å®‰å…¨ï¼‰
```

#### æ ¸å¿ƒ API

```c
#include "ts_variable.h"

// åˆå§‹åŒ–ï¼ˆts_automation æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨è°ƒç”¨ï¼‰
esp_err_t ts_variable_init(void);

// æ£€æŸ¥åˆå§‹åŒ–çŠ¶æ€ï¼ˆç”¨äºè·¨é˜¶æ®µè°ƒç”¨ï¼‰
bool ts_variable_is_initialized(void);

// ç±»å‹å®‰å…¨çš„è®¾ç½® APIï¼ˆå— READONLY æ ‡å¿—ä¿æŠ¤ï¼‰
esp_err_t ts_variable_set_string(const char *name, const char *value, const char *source_id);
esp_err_t ts_variable_set_int(const char *name, int value, const char *source_id);
esp_err_t ts_variable_set_float(const char *name, float value, const char *source_id);
esp_err_t ts_variable_set_bool(const char *name, bool value, const char *source_id);

// å†…éƒ¨ APIï¼ˆç»•è¿‡ READONLY æ£€æŸ¥ï¼Œä»…é™ç³»ç»Ÿç»„ä»¶ä½¿ç”¨ï¼‰
esp_err_t ts_variable_set_internal(const char *name, const ts_auto_value_t *value);

// ç±»å‹å®‰å…¨çš„è·å– API
esp_err_t ts_variable_get(const char *name, ts_auto_value_t *value);
const char* ts_variable_get_string(const char *name, const char *default_val);
int ts_variable_get_int(const char *name, int default_val);
float ts_variable_get_float(const char *name, float default_val);
bool ts_variable_get_bool(const char *name, bool default_val);

// æ£€æŸ¥å­˜åœ¨æ€§
bool ts_variable_exists(const char *name);

// æšä¸¾å˜é‡
esp_err_t ts_variable_iterate(ts_variable_iterate_fn callback, void *user_data);

// æŒ‰æºåˆ é™¤å˜é‡
esp_err_t ts_variable_delete_by_source(const char *source_id);
```

#### åªè¯»å˜é‡ä¸å†…éƒ¨æ›´æ–°

æŸäº›ç³»ç»Ÿå˜é‡ï¼ˆå¦‚ `power_policy.*`ï¼‰è¢«æ ‡è®°ä¸º `TS_AUTO_VAR_READONLY`ï¼Œç”¨æˆ·æ— æ³•é€šè¿‡ API ä¿®æ”¹ã€‚
ç³»ç»Ÿç»„ä»¶éœ€è¦æ›´æ–°è¿™äº›å˜é‡æ—¶ï¼Œä½¿ç”¨ `ts_variable_set_internal()` ç»•è¿‡åªè¯»æ£€æŸ¥ï¼š

```c
// ç”µå‹ä¿æŠ¤æ¨¡å—æ›´æ–°åªè¯»å˜é‡
void ts_power_policy_update_variables(void) {
    ts_auto_value_t val;
    val.type = TS_AUTO_VAL_FLOAT;
    val.value.f = current_voltage;
    ts_variable_set_internal("power_policy.voltage", &val);  // ç»•è¿‡åªè¯»æ£€æŸ¥
}
```

#### SSH å‘½ä»¤ç»“æœå˜é‡

SSH å‘½ä»¤æ‰§è¡Œåè‡ªåŠ¨å­˜å‚¨ 7 ä¸ªæ ‡å‡†å˜é‡ï¼ˆé€šè¿‡ `source_id` åˆ†ç»„ï¼‰ï¼š

| å˜é‡å | ç±»å‹ | æè¿° |
|--------|------|------|
| `<source_id>.status` | STRING | æ‰§è¡ŒçŠ¶æ€ï¼šrunning/completed/cancelled/failed |
| `<source_id>.exit_code` | INT | é€€å‡ºç ï¼ˆ0=æˆåŠŸï¼‰ |
| `<source_id>.extracted` | STRING | æ­£åˆ™æå–çš„å†…å®¹ |
| `<source_id>.expect_matched` | BOOL | æ˜¯å¦åŒ¹é…æˆåŠŸæ¨¡å¼ |
| `<source_id>.fail_matched` | BOOL | æ˜¯å¦åŒ¹é…å¤±è´¥æ¨¡å¼ |
| `<source_id>.host` | STRING | æ‰§è¡Œä¸»æœº |
| `<source_id>.timestamp` | INT | æ‰§è¡Œæ—¶é—´æˆ³ |

#### æ•°æ®æºé›†æˆç¤ºä¾‹

```c
// ts_source_manager å°†è¿œç¨‹æ•°æ®æ˜ å°„ä¸ºå˜é‡
void on_data_received(const char *source_id, cJSON *data) {
    // ä½¿ç”¨ JSONPath æå–å€¼
    double temp = ts_jsonpath_get_number(data, "temperature.cpu", 0.0);
    
    // ç›´æ¥å­˜å‚¨ä¸º float ç±»å‹å˜é‡
    ts_variable_set_float("agx.cpu_temp", (float)temp, source_id);
}
```

#### è§„åˆ™å¼•æ“é›†æˆç¤ºä¾‹

```c
// ts_rule_engine è¯„ä¼°æ¡ä»¶è¡¨è¾¾å¼
bool evaluate_condition(const char *expr) {
    // è§£æè¡¨è¾¾å¼: "agx.cpu_temp > 80"
    char var_name[64], op[8];
    double threshold;
    parse_expression(expr, var_name, op, &threshold);
    
    // ä½¿ç”¨ç±»å‹å®‰å…¨çš„ API è·å–å€¼
    float value = ts_variable_get_float(var_name, 0.0f);
    
    // æ¯”è¾ƒ
    return compare(value, op, threshold);
}
```

#### åŠ¨ä½œæ‰§è¡Œé›†æˆç¤ºä¾‹

```c
// ts_action_manager æ‰§è¡Œ SSH å‘½ä»¤æ—¶ä½¿ç”¨å˜é‡å¼•ç”¨
esp_err_t execute_ssh_action(const ts_action_t *action) {
    // åŸå§‹å‘½ä»¤: "echo Temperature: ${agx.cpu_temp}"
    // è·å–å˜é‡å€¼
    const char *temp = ts_variable_get_string("agx.cpu_temp", "N/A");
    
    // æ„å»ºæœ€ç»ˆå‘½ä»¤
    char expanded[512];
    snprintf(expanded, sizeof(expanded), "echo Temperature: %s", temp);
    
    return ts_ssh_execute(action->host, expanded, ...);
}
```

#### å˜é‡å‘½åçº¦å®š

| å‰ç¼€ | æ¥æº | ç¤ºä¾‹ |
|------|------|------|
| `sys.*` | ç³»ç»Ÿå†…ç½® | `sys.time`, `sys.ip` |
| `agx.*` | Jetson AGX æ•°æ® | `agx.cpu_temp`, `agx.gpu_usage` |
| `esp32.*` | ESP32 æœ¬åœ°æ•°æ® | `esp32.heap_free`, `esp32.chip_temp` |
| `last.*` | æœ€åä¸€æ¬¡ SSH ç»“æœ | `last.extracted`, `last.status` |
| `<cmd>.*` | æŒ‡å®šå‘½ä»¤çš„ç»“æœ | `ping_test.exit_code` |

#### å†…å­˜ç‰¹æ€§

- 64 ä¸ªå˜é‡æ§½ä½ï¼Œæ¯ä¸ªçº¦ 336 å­—èŠ‚
- æ€»è®¡çº¦ 21KBï¼Œä¼˜å…ˆåˆ†é…åˆ° **PSRAM**
- è‡ªåŠ¨ fallback åˆ° DRAM

---

## 9. å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒæ¡†æ¶ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**: å»ºç«‹åŸºæœ¬æ¶æ„ï¼Œé…ç½®åŠ è½½

- [x] åˆ›å»º `ts_automation` ç»„ä»¶éª¨æ¶ âœ…
- [x] å®šä¹‰é…ç½® JSON Schema âœ…
- [x] å®ç°é…ç½®æ–‡ä»¶åŠ è½½ (SD å¡ / NVS) âœ…
- [x] å®ç°é…ç½®éªŒè¯ âœ…
- [x] åˆ›å»º `ts_variable` ç»Ÿä¸€å˜é‡å­˜å‚¨ âœ… (2026-01-27)

> **æ³¨æ„**ï¼šåŸ `ts_var` ç»„ä»¶å·²åºŸå¼ƒï¼Œç»Ÿä¸€ä½¿ç”¨ `ts_variable`ã€‚

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤ŸåŠ è½½å¹¶è§£æ JSON é…ç½®æ–‡ä»¶ âœ…

### Phase 2: æ•°æ®æºç³»ç»Ÿ âœ… **å·²å®Œæˆ**

**ç›®æ ‡**: å®ç°æ•°æ®é‡‡é›†

- [x] åˆ›å»º `ts_source_manager` ç»„ä»¶ âœ…
- [x] å®ç°å†…ç½®æ•°æ®æº (ESP32 ç³»ç»Ÿ/ç½‘ç»œ/ADC) âœ…
- [x] å®ç° WebSocket/Socket.IO æ•°æ®æº âœ…
- [x] å®ç° REST æ•°æ®æº âœ…
- [x] å®ç° SSH å‘½ä»¤æ•°æ®æº âœ…
- [x] JSON Path å­—æ®µæå– âœ…
- [x] æ•°æ®æ›´æ–°äº‹ä»¶å‘å¸ƒ âœ…

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿé‡‡é›† ESP32 æœ¬åœ°æ•°æ®å’Œè¿œç¨‹æ•°æ® âœ…

### Phase 3: è§„åˆ™å¼•æ“ (é¢„è®¡ 3 å¤©)

**ç›®æ ‡**: å®ç°æ¡ä»¶åˆ¤æ–­

- [x] åˆ›å»º `ts_rule_engine` ç»„ä»¶ âœ…
- [ ] å®ç°è¡¨è¾¾å¼è§£æå™¨
- [ ] å®ç°æ¡ä»¶æ±‚å€¼
- [ ] å®ç°è§¦å‘å™¨ç±»å‹ (condition/event/timer)
- [ ] é˜²æŠ–/æŒç»­æ—¶é—´é€»è¾‘
- [ ] è§„åˆ™ä¼˜å…ˆçº§å¤„ç†

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿæ ¹æ®æ¡ä»¶è§¦å‘è§„åˆ™

### Phase 4: åŠ¨ä½œç³»ç»Ÿ (é¢„è®¡ 2 å¤©)

**ç›®æ ‡**: å®ç°åŠ¨ä½œæ‰§è¡Œ

- [x] åˆ›å»º `ts_action_manager` ç»„ä»¶ âœ…
- [ ] å®ç° LED åŠ¨ä½œ (touch/board/matrix)
- [x] å®ç° SSH åŠ¨ä½œ (é›†æˆç°æœ‰ API) âœ…
- [ ] å®ç°æ—¥å¿—/å˜é‡/å»¶æ—¶åŠ¨ä½œ
- [ ] æ¡ä»¶åŠ¨ä½œæ”¯æŒ
- [ ] åŠ¨ä½œé“¾å¼æ‰§è¡Œ

**éªŒæ”¶æ ‡å‡†**: è§„åˆ™è§¦å‘åèƒ½æ­£ç¡®æ‰§è¡ŒåŠ¨ä½œ

### Phase 5: WebUI (é¢„è®¡ 4 å¤©)

**ç›®æ ‡**: å¯è§†åŒ–é…ç½®ç•Œé¢

- [ ] æ•°æ®æºé…ç½®é¡µé¢
- [ ] è§„åˆ™ç¼–è¾‘å™¨
- [ ] å‘½ä»¤é¢æ¿é…ç½®
- [ ] SSH ä¸»æœºç®¡ç†
- [ ] å®æ—¶ç›‘æ§é¢æ¿
- [ ] é…ç½®å¯¼å…¥/å¯¼å‡º

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿé€šè¿‡ WebUI å®Œæ•´é…ç½®è‡ªåŠ¨åŒ–ç³»ç»Ÿ

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (é¢„è®¡ 2 å¤©)

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

## 10. é™„å½•

### A. å˜é‡å¼•ç”¨è¯­æ³•

```
${source_id.field_id}           # åŸºæœ¬å¼•ç”¨
${source_id.field_id:%.2f}      # å¸¦æ ¼å¼åŒ–
${source_id.field_id:default}   # é»˜è®¤å€¼
```

### B. å†…ç½®äº‹ä»¶åˆ—è¡¨

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| `startup` | ç³»ç»Ÿå¯åŠ¨å®Œæˆ |
| `data.updated.<source_id>` | æ•°æ®æºæ›´æ–° |
| `ssh.completed` | SSH å‘½ä»¤å®Œæˆ |
| `ssh.timeout` | SSH å‘½ä»¤è¶…æ—¶ |
| `network.wifi_connected` | WiFi è¿æ¥ |
| `network.wifi_disconnected` | WiFi æ–­å¼€ |
| `network.ip_changed` | IP åœ°å€å˜æ›´ |
| `service.started.<name>` | æœåŠ¡å¯åŠ¨ |
| `service.stopped.<name>` | æœåŠ¡åœæ­¢ |
| `timer.<interval>` | å®šæ—¶å™¨è§¦å‘ |

### C. é¢œè‰²æ ¼å¼

æ”¯æŒä»¥ä¸‹é¢œè‰²æ ¼å¼ï¼š

- åå…­è¿›åˆ¶: `#FF0000`, `#F00`
- RGB: `rgb(255, 0, 0)`
- å‘½åé¢œè‰²: `red`, `green`, `blue`, `yellow`, `orange`, `white`, `black`
- æ¸å˜: `gradient` (æ ¹æ®æ•°å€¼è‡ªåŠ¨æ˜ å°„)

### D. ç°æœ‰ HAL/é©±åŠ¨ç»„ä»¶æ˜ å°„

| ç»„ä»¶ | å¤´æ–‡ä»¶ | ç”¨äºå†…ç½®æ•°æ®æº |
|------|--------|---------------|
| `ts_hal` | `ts_hal.h` | ç³»ç»Ÿèƒ½åŠ›ã€GPIOã€ADCã€PWM |
| `ts_hal_gpio` | `ts_hal_gpio.h` | GPIO çŠ¶æ€è¯»å–/æ§åˆ¶ |
| `ts_hal_adc` | `ts_hal_adc.h` | ADC ç”µå‹è¯»å– |
| `ts_power_monitor` | `ts_power_monitor.h` | ç”µæºç”µå‹/ç”µæµç›‘æ§ |
| `ts_device_ctrl` | `ts_device_ctrl.h` | AGX/LPMU ç”µæºæ§åˆ¶ |
| `ts_net` | `ts_net.h` | ç½‘ç»œçŠ¶æ€ |
| `ts_wifi` | `ts_wifi.h` | WiFi è¿æ¥çŠ¶æ€ |
| `ts_eth` | `ts_eth.h` | ä»¥å¤ªç½‘çŠ¶æ€ |
| `ts_led` | `ts_led.h` | LED æ§åˆ¶ |
| `ts_service` | `ts_service.h` | æœåŠ¡çŠ¶æ€ |
| `ts_cert` | `ts_cert.h` | PKI è¯ä¹¦çŠ¶æ€ |

### E. å¼•è„šé…ç½®å‚è€ƒ (rm01_esp32s3)

| åŠŸèƒ½ | GPIO | è¯´æ˜ |
|------|------|------|
| LED_TOUCH | 45 | Touch LED WS2812 |
| LED_BOARD | 42 | Board LED WS2812 |
| LED_MATRIX | 9 | Matrix LED WS2812 |
| POWER_ADC | 18 | ç”µå‹ç›‘æ§ ADC (11.4:1 åˆ†å‹) |
| POWER_UART_RX | 47 | ç”µæºèŠ¯ç‰‡ UART |
| AGX_FORCE_SHUTDOWN | 3 | AGX å¼ºåˆ¶å…³æœº |
| AGX_RESET | 1 | AGX å¤ä½ |
| AGX_RECOVERY | 40 | AGX æ¢å¤æ¨¡å¼ |
| LPMU_POWER | 46 | LPMU ç”µæºæŒ‰é’® |
| LPMU_RESET | 2 | LPMU å¤ä½ |
| FAN_PWM_0 | 41 | é£æ‰‡ PWM |

### F. é…ç½®å¯¼å…¥å¯¼å‡º

è‡ªåŠ¨åŒ–é…ç½®æ”¯æŒé€šè¿‡ Config Pack ç³»ç»Ÿè¿›è¡ŒåŠ å¯†å¯¼å…¥å¯¼å‡ºï¼š

#### API ç«¯ç‚¹

| API | åŠŸèƒ½ |
|-----|------|
| `automation.sources.export` | å¯¼å‡ºæ•°æ®æºä¸º .tscfg |
| `automation.sources.import` | å¯¼å…¥æ•°æ®æºé…ç½®åŒ… |
| `automation.rules.export` | å¯¼å‡ºè§„åˆ™ä¸º .tscfg |
| `automation.rules.import` | å¯¼å…¥è§„åˆ™é…ç½®åŒ… |
| `automation.actions.export` | å¯¼å‡ºåŠ¨ä½œæ¨¡æ¿ä¸º .tscfg |
| `automation.actions.import` | å¯¼å…¥åŠ¨ä½œæ¨¡æ¿é…ç½®åŒ… |

#### å­˜å‚¨è·¯å¾„

| é…ç½®ç±»å‹ | SD å¡è·¯å¾„ |
|---------|----------|
| æ•°æ®æº | `/sdcard/config/sources/` |
| è§„åˆ™ | `/sdcard/config/rules/` |
| åŠ¨ä½œæ¨¡æ¿ | `/sdcard/config/actions/` |

#### å¯¼å…¥æµç¨‹

1. ä¸Šä¼  .tscfg æ–‡ä»¶
2. åç«¯éªŒè¯ç­¾åï¼ˆä¸è§£å¯†ï¼‰
3. é¢„è§ˆé…ç½® IDã€ç­¾åè€…ä¿¡æ¯
4. ç¡®è®¤å¯¼å…¥ â†’ ä¿å­˜åˆ° SD å¡
5. é‡å¯ç³»ç»Ÿåè‡ªåŠ¨è§£å¯†å¹¶åŠ è½½

è¯¦ç»† API æ–‡æ¡£å‚è§ï¼š[API_REFERENCE.md](API_REFERENCE.md#è‡ªåŠ¨åŒ–é…ç½®å¯¼å…¥å¯¼å‡º-api)

### G. ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2026-01-26 | åˆå§‹ç‰ˆæœ¬ |
| 1.1 | 2026-01-26 | æ›´æ–°å†…ç½®æ•°æ®æºæ˜ å°„åˆ°å®é™…ä»£ç ï¼›é‡æ–°è®¾è®¡ Dashboard WebUI |
| 2.2 | 2026-02-04 | æ·»åŠ é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½æ–‡æ¡£ |
