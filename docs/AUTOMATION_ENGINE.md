# TianShanOS è‡ªåŠ¨åŒ–å¼•æ“è®¾è®¡æ–‡æ¡£

> **æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
> **åˆ›å»ºæ—¥æœŸ**: 2026-01-26  
> **çŠ¶æ€**: è®¾è®¡é˜¶æ®µ

---

## ç›®å½•

1. [æ¦‚è¿°](#1-æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [æ•°æ®æºç³»ç»Ÿ](#3-æ•°æ®æºç³»ç»Ÿ)
4. [è§„åˆ™å¼•æ“](#4-è§„åˆ™å¼•æ“)
5. [åŠ¨ä½œç³»ç»Ÿ](#5-åŠ¨ä½œç³»ç»Ÿ)
6. [é…ç½® Schema](#6-é…ç½®-schema)
7. [WebUI è®¾è®¡](#7-webui-è®¾è®¡)
8. [ç»„ä»¶è®¾è®¡](#8-ç»„ä»¶è®¾è®¡)
9. [å®ç°è®¡åˆ’](#9-å®ç°è®¡åˆ’)
10. [é™„å½•](#10-é™„å½•)

---

## 1. æ¦‚è¿°

### 1.1 è®¾è®¡ç›®æ ‡

TianShanOS è‡ªåŠ¨åŒ–å¼•æ“æ˜¯ä¸€ä¸ª**å¯é…ç½®çš„äº‹ä»¶é©±åŠ¨ç³»ç»Ÿ**ï¼Œç”¨äºï¼š

- ğŸ“Š **ç›‘æ§**: é‡‡é›† ESP32 æœ¬åœ°æ•°æ®å’Œè¿œç¨‹æœåŠ¡å™¨ï¼ˆAGX/LPMUï¼‰è¿è¡Œæ•°æ®
- ğŸ”„ **è‡ªåŠ¨åŒ–**: åŸºäºæ¡ä»¶è§„åˆ™è‡ªåŠ¨è§¦å‘åŠ¨ä½œ
- ğŸ–¥ï¸ **æ˜¾ç¤º**: å°†ç›‘æ§æ•°æ®å’Œç³»ç»ŸçŠ¶æ€å±•ç¤ºåˆ° LED ä¸‰ä¸ªæ˜¾ç¤ºåŒºåŸŸ
- ğŸ® **æ§åˆ¶**: é€šè¿‡ SSH æ‰§è¡Œè¿œç¨‹æœåŠ¡å™¨æ§åˆ¶å‘½ä»¤
- âš¡ **åé¦ˆ**: å‘½ä»¤æ‰§è¡Œç»“æœå¯è§¦å‘åç»­è§„åˆ™

### 1.2 æ ¸å¿ƒç†å¿µ

```
é¢å‘é…ç½®ï¼Œè€Œéé¢å‘ä»£ç 
```

ç”¨æˆ·é€šè¿‡ JSON é…ç½®ï¼ˆå¯é€šè¿‡ WebUI å¯è§†åŒ–ç¼–è¾‘ï¼‰å®šä¹‰ï¼š
- ç›‘æ§ä»€ä¹ˆæ•°æ®
- ä»€ä¹ˆæ¡ä»¶è§¦å‘ä»€ä¹ˆåŠ¨ä½œ
- LED æ˜¾ç¤ºä»€ä¹ˆå†…å®¹

### 1.3 æ ¸å¿ƒæ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **æ•°æ®æº (Source)** | æ•°æ®æ¥æºå®šä¹‰ | ESP32 å†…ç½®ã€WebSocketã€REST API |
| **å­—æ®µ (Field)** | æ•°æ®æºä¸­çš„å…·ä½“æ•°æ®ç‚¹ | `agx.cpu_temp`, `esp32.voltage` |
| **äº‹ä»¶ (Event)** | ç³»ç»Ÿä¸­å‘ç”Ÿçš„çŠ¶æ€å˜åŒ– | æ•°æ®æ›´æ–°ã€å‘½ä»¤å®Œæˆã€å®šæ—¶å™¨è§¦å‘ |
| **æ¡ä»¶ (Condition)** | åˆ¤æ–­è¡¨è¾¾å¼ | `agx.cpu_temp > 80 AND agx.gpu_temp > 75` |
| **åŠ¨ä½œ (Action)** | è¦æ‰§è¡Œçš„æ“ä½œ | LED æ˜¾ç¤ºã€SSH å‘½ä»¤ã€æ—¥å¿—è®°å½• |
| **è§„åˆ™ (Rule)** | è§¦å‘æ¡ä»¶ + åŠ¨ä½œåˆ—è¡¨ | å½“æ¸©åº¦è¿‡é«˜æ—¶ï¼Œæ˜¾ç¤ºè­¦å‘Šå¹¶æ‰§è¡Œé™é¢‘ |

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         TianShanOS Automation Engine                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        äº‹ä»¶æº (Event Sources)                        â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  ESP32 å†…ç½®         è¿œç¨‹æ•°æ®             å‘½ä»¤åé¦ˆ         ç³»ç»Ÿäº‹ä»¶   â”‚   â”‚
â”‚   â”‚  â€¢ system.*        â€¢ agx.* (WS)        â€¢ ssh.result.*  â€¢ timer.*   â”‚   â”‚
â”‚   â”‚  â€¢ network.*       â€¢ lpmu.* (REST)     â€¢ command.*     â€¢ startup   â”‚   â”‚
â”‚   â”‚  â€¢ adc.*           â€¢ custom.*                          â€¢ service.* â”‚   â”‚
â”‚   â”‚  â€¢ gpio.*                                                          â”‚   â”‚
â”‚   â”‚  â€¢ service.*                                                       â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                      å˜é‡å­˜å‚¨ (Variable Store)                       â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   æ‰€æœ‰æ•°æ®ç‚¹ç»Ÿä¸€å­˜å‚¨ï¼Œæ”¯æŒå˜é‡å¼•ç”¨ ${source.field}                    â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                        è§„åˆ™å¼•æ“ (Rule Engine)                        â”‚   â”‚
â”‚   â”‚                                                                     â”‚   â”‚
â”‚   â”‚   â€¢ æ¡ä»¶è¡¨è¾¾å¼è§£æä¸æ±‚å€¼                                             â”‚   â”‚
â”‚   â”‚   â€¢ è§¦å‘ç±»å‹ï¼šcondition / event / timer / startup                   â”‚   â”‚
â”‚   â”‚   â€¢ é˜²æŠ– (debounce) / æŒç»­æ—¶é—´ (sustain) / èŠ‚æµ (throttle)          â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                  â”‚                                          â”‚
â”‚                                  â–¼                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                         åŠ¨ä½œæ‰§è¡Œ (Actions)                           â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚  LED æ˜¾ç¤º         SSH å‘½ä»¤          GPIO æ§åˆ¶       å…¶ä»–åŠ¨ä½œ         â”‚   â”‚
â”‚   â”‚  â€¢ led.touch      â€¢ ssh.exec        â€¢ gpio.set      â€¢ log           â”‚   â”‚
â”‚   â”‚  â€¢ led.board      â€¢ ssh.exec_async  â€¢ gpio.toggle   â€¢ variable.set  â”‚   â”‚
â”‚   â”‚  â€¢ led.matrix                                       â€¢ trigger_rule  â”‚   â”‚
â”‚   â”‚                                                     â€¢ delay         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ•°æ®æµ

```
æ•°æ®é‡‡é›† â”€â”€â–º å˜é‡å­˜å‚¨ â”€â”€â–º è§„åˆ™è¯„ä¼° â”€â”€â–º åŠ¨ä½œæ‰§è¡Œ
    â”‚                        â”‚              â”‚
    â”‚                        â”‚              â–¼
    â”‚                        â”‚         å‘½ä»¤åé¦ˆ â”€â”€â”
    â”‚                        â”‚                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    (å¾ªç¯)
```

### 2.3 ä¸ç°æœ‰ç³»ç»Ÿé›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      TianShanOS ç»„ä»¶å…³ç³»                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚ ts_event    â”‚â—„â”€â”€â”€â”€ æ‰€æœ‰ç»„ä»¶é€šè¿‡äº‹ä»¶æ€»çº¿é€šä¿¡                   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚          â”‚                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚             â”‚                                               â”‚
â”‚   â–¼             â–¼                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚ â”‚ ts_led  â”‚  â”‚ts_automationâ”‚â—„â”€â”€â”€â”€ æ–°å¢ï¼šè‡ªåŠ¨åŒ–å¼•æ“               â”‚
â”‚ â”‚(Core API)â”‚  â”‚             â”‚                                    â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚                     â”‚                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚
â”‚          â–¼         â–¼          â–¼                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚    â”‚ts_source â”‚ â”‚ ts_rule  â”‚ â”‚ts_action â”‚                       â”‚
â”‚    â”‚æ•°æ®é‡‡é›†   â”‚ â”‚è§„åˆ™å¼•æ“   â”‚ â”‚åŠ¨ä½œæ‰§è¡Œ   â”‚                       â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚          â”‚                          â”‚                           â”‚
â”‚          â”‚                          â–¼                           â”‚
â”‚          â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚          â”‚                   â”‚ ts_security â”‚                    â”‚
â”‚          â”‚                   â”‚ (SSH æ‰§è¡Œ)  â”‚                    â”‚
â”‚          â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚          â”‚                                                      â”‚
â”‚          â–¼                                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
â”‚   â”‚   ts_net    â”‚                                               â”‚
â”‚   â”‚(WS/HTTPå®¢æˆ·ç«¯)â”‚                                              â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®æºç³»ç»Ÿ

### 3.1 æ•°æ®æºç±»å‹

| ç±»å‹ | æ ‡è¯† | è¯´æ˜ | å®ç°æ–¹å¼ |
|------|------|------|----------|
| **å†…ç½®** | `builtin` | ESP32 æœ¬åœ°æ•°æ® | ç›´æ¥è°ƒç”¨ ESP-IDF API |
| **WebSocket** | `websocket` | å®æ—¶æ¨é€æ•°æ® | esp_websocket_client |
| **REST** | `rest` | HTTP è½®è¯¢æ•°æ® | esp_http_client |
| **MQTT** | `mqtt` | MQTT è®¢é˜… (å¯é€‰) | esp_mqtt_client |

### 3.2 å†…ç½®æ•°æ®æº

ESP32 æœ¬åœ°æ•°æ®é€šè¿‡ `builtin` ç±»å‹å®šä¹‰ï¼Œç³»ç»Ÿè‡ªåŠ¨é‡‡é›†ï¼š

#### 3.2.1 ç³»ç»Ÿæ•°æ® (`system.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ | æ¥æº |
|-----------|------|------|------|------|
| `system.heap_free` | å¯ç”¨å †å†…å­˜ | number | KB | `esp_get_free_heap_size()` |
| `system.heap_min_free` | å†å²æœ€å°å¯ç”¨å†…å­˜ | number | KB | `esp_get_minimum_free_heap_size()` |
| `system.psram_free` | å¯ç”¨ PSRAM | number | KB | `heap_caps_get_free_size(SPIRAM)` |
| `system.psram_total` | PSRAM æ€»é‡ | number | KB | `heap_caps_get_total_size(SPIRAM)` |
| `system.cpu_freq` | CPU é¢‘ç‡ | number | MHz | `esp_clk_cpu_freq()` |
| `system.uptime` | è¿è¡Œæ—¶é—´ | number | s | `esp_timer_get_time()` |
| `system.chip_temp` | èŠ¯ç‰‡æ¸©åº¦ | number | Â°C | æ¸©åº¦ä¼ æ„Ÿå™¨ API |
| `system.reset_reason` | ä¸Šæ¬¡é‡å¯åŸå›  | string | - | `esp_reset_reason()` |

#### 3.2.2 ç½‘ç»œæ•°æ® (`network.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ |
|-----------|------|------|------|
| `network.wifi_connected` | WiFi è¿æ¥çŠ¶æ€ | bool | - |
| `network.wifi_rssi` | WiFi ä¿¡å·å¼ºåº¦ | number | dBm |
| `network.wifi_ssid` | å½“å‰ SSID | string | - |
| `network.ip_address` | IP åœ°å€ | string | - |
| `network.mac_address` | MAC åœ°å€ | string | - |
| `network.eth_connected` | ä»¥å¤ªç½‘è¿æ¥çŠ¶æ€ | bool | - |

#### 3.2.3 ADC æ•°æ® (`adc.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ | å•ä½ |
|-----------|------|------|------|
| `adc.voltage_main` | ä¸»ç”µå‹ | number | V |
| `adc.current_main` | ä¸»ç”µæµ | number | A |
| `adc.power_main` | åŠŸç‡ | number | W |
| `adc.channel_N` | ADC é€šé“ N åŸå§‹å€¼ | number | - |

> **æ³¨**: ADC æ•°æ®éœ€è¦é…åˆ `boards/*/pins.json` ä¸­çš„ ADC å¼•è„šé…ç½®

#### 3.2.4 GPIO æ•°æ® (`gpio.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ |
|-----------|------|------|
| `gpio.pin_N` | GPIO N ç”µå¹³ | bool |
| `gpio.agx_power_state` | AGX ç”µæºçŠ¶æ€ | string |
| `gpio.lpmu_power_state` | LPMU ç”µæºçŠ¶æ€ | string |

#### 3.2.5 æœåŠ¡æ•°æ® (`service.*`)

| builtin ID | è¯´æ˜ | ç±»å‹ |
|-----------|------|------|
| `service.<name>.running` | æœåŠ¡æ˜¯å¦è¿è¡Œ | bool |
| `service.<name>.healthy` | æœåŠ¡æ˜¯å¦å¥åº· | bool |
| `service.pki.status` | PKI çŠ¶æ€ | string |
| `service.pki.cert_days_left` | è¯ä¹¦å‰©ä½™å¤©æ•° | number |
| `service.https.connections` | HTTPS å½“å‰è¿æ¥æ•° | number |

### 3.3 è¿œç¨‹æ•°æ®æºé…ç½®

#### WebSocket æ•°æ®æº

```json
{
  "id": "agx",
  "name": "AGX Orin",
  "type": "websocket",
  "config": {
    "url": "ws://192.168.1.100:58090/socket.io/",
    "reconnect": true,
    "reconnect_interval": 5000,
    "ping_interval": 30000
  },
  "interval": 1000,
  "enabled": true,
  "fields": [
    {"id": "cpu_usage", "path": "cpu.percent", "name": "CPUä½¿ç”¨ç‡", "unit": "%", "type": "number"},
    {"id": "cpu_temp", "path": "cpu.temp", "name": "CPUæ¸©åº¦", "unit": "Â°C", "type": "number"},
    {"id": "gpu_usage", "path": "gpu.percent", "name": "GPUä½¿ç”¨ç‡", "unit": "%", "type": "number"},
    {"id": "gpu_temp", "path": "gpu.temp", "name": "GPUæ¸©åº¦", "unit": "Â°C", "type": "number"},
    {"id": "mem_used", "path": "memory.used_gb", "name": "å†…å­˜ä½¿ç”¨", "unit": "GB", "type": "number"},
    {"id": "mem_total", "path": "memory.total_gb", "name": "å†…å­˜æ€»é‡", "unit": "GB", "type": "number"},
    {"id": "power", "path": "power.watts", "name": "åŠŸè€—", "unit": "W", "type": "number"}
  ]
}
```

#### REST æ•°æ®æº

```json
{
  "id": "lpmu",
  "name": "LPMU æœåŠ¡å™¨",
  "type": "rest",
  "config": {
    "url": "http://192.168.1.101:8080/api/status",
    "method": "GET",
    "headers": {
      "Authorization": "Bearer ${secrets.lpmu_token}"
    },
    "timeout": 5000
  },
  "interval": 5000,
  "enabled": true,
  "fields": [
    {"id": "status", "path": "status", "name": "è¿è¡ŒçŠ¶æ€", "type": "string"},
    {"id": "model_name", "path": "inference.model", "name": "å½“å‰æ¨¡å‹", "type": "string"},
    {"id": "model_fps", "path": "inference.fps", "name": "æ¨ç†FPS", "type": "number"},
    {"id": "queue_length", "path": "inference.queue", "name": "é˜Ÿåˆ—é•¿åº¦", "type": "number"}
  ]
}
```

### 3.4 å­—æ®µè·¯å¾„è§£æ (JSON Path)

æ”¯æŒç®€åŒ–çš„ JSON Path è¯­æ³•ä»å“åº”ä¸­æå–æ•°æ®ï¼š

| è¯­æ³• | ç¤ºä¾‹ | è¯´æ˜ |
|------|------|------|
| `key` | `status` | é¡¶å±‚å­—æ®µ |
| `key.subkey` | `cpu.temp` | åµŒå¥—å­—æ®µ |
| `key[0]` | `gpus[0]` | æ•°ç»„ç´¢å¼• |
| `key[0].subkey` | `gpus[0].temp` | æ•°ç»„å…ƒç´ çš„å­—æ®µ |

---

## 4. è§„åˆ™å¼•æ“

### 4.1 è§„åˆ™ç»“æ„

```json
{
  "id": "rule_id",
  "name": "è§„åˆ™åç§°",
  "enabled": true,
  "priority": 0,
  "trigger": { ... },
  "actions": [ ... ]
}
```

### 4.2 è§¦å‘å™¨ç±»å‹

#### 4.2.1 æ¡ä»¶è§¦å‘ (`condition`)

å½“è¡¨è¾¾å¼ç»“æœä» false å˜ä¸º true æ—¶è§¦å‘ï¼š

```json
{
  "type": "condition",
  "expression": "agx.cpu_temp > 80 AND agx.gpu_temp > 75",
  "debounce": 3000,
  "sustain": 0
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `expression` | æ¡ä»¶è¡¨è¾¾å¼ | å¿…å¡« |
| `debounce` | é˜²æŠ–æ—¶é—´ (ms)ï¼Œè§¦å‘å N æ¯«ç§’å†…ä¸é‡å¤è§¦å‘ | 0 |
| `sustain` | æŒç»­æ—¶é—´ (ms)ï¼Œæ¡ä»¶éœ€æŒç»­æ»¡è¶³ N æ¯«ç§’æ‰è§¦å‘ | 0 |

#### 4.2.2 äº‹ä»¶è§¦å‘ (`event`)

å½“ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶è§¦å‘ï¼š

```json
{
  "type": "event",
  "event": "ssh.completed",
  "filter": "ssh.last.host == 'agx_ssh' AND ssh.last.exit_code != 0"
}
```

**æ”¯æŒçš„äº‹ä»¶**:

| äº‹ä»¶ | è¯´æ˜ | é™„åŠ æ•°æ® |
|------|------|---------|
| `data.updated.<source_id>` | æ•°æ®æºæ›´æ–° | æ›´æ–°çš„å­—æ®µåˆ—è¡¨ |
| `ssh.completed` | SSH å‘½ä»¤å®Œæˆ | exit_code, stdout, stderr |
| `network.wifi_connected` | WiFi è¿æ¥æˆåŠŸ | IP åœ°å€ |
| `network.wifi_disconnected` | WiFi æ–­å¼€ | - |
| `service.started.<name>` | æœåŠ¡å¯åŠ¨ | - |
| `service.stopped.<name>` | æœåŠ¡åœæ­¢ | - |
| `startup` | ç³»ç»Ÿå¯åŠ¨å®Œæˆ | - |

#### 4.2.3 å®šæ—¶è§¦å‘ (`timer`)

æŒ‰æ—¶é—´é—´éš”æˆ– Cron è¡¨è¾¾å¼è§¦å‘ï¼š

```json
{
  "type": "timer",
  "interval": 60000
}
```

æˆ–

```json
{
  "type": "timer",
  "cron": "0 * * * *"
}
```

#### 4.2.4 å¯åŠ¨è§¦å‘ (`startup`)

ç³»ç»Ÿå¯åŠ¨å®Œæˆåè§¦å‘ä¸€æ¬¡ï¼š

```json
{
  "type": "startup",
  "delay": 5000
}
```

### 4.3 æ¡ä»¶è¡¨è¾¾å¼è¯­æ³•

#### æ”¯æŒçš„è¿ç®—ç¬¦

| ç±»å‹ | è¿ç®—ç¬¦ | ç¤ºä¾‹ |
|------|--------|------|
| æ¯”è¾ƒ | `>`, `<`, `>=`, `<=`, `==`, `!=` | `agx.cpu_temp > 80` |
| é€»è¾‘ | `AND`, `OR`, `NOT` | `a > 1 AND b < 2` |
| æ‹¬å· | `(`, `)` | `(a > 1 OR b > 2) AND c == 0` |
| å­—ç¬¦ä¸² | `==`, `!=`, `contains` | `lpmu.status == "running"` |
| å­˜åœ¨æ€§ | `exists`, `!exists` | `exists(agx.cpu_temp)` |

#### å˜é‡å¼•ç”¨

```
${source_id.field_id}   # å®Œæ•´å¼•ç”¨
source_id.field_id      # ç®€å†™ï¼ˆæ¡ä»¶è¡¨è¾¾å¼ä¸­ï¼‰
```

#### ç¤ºä¾‹

```
# ç®€å•æ¯”è¾ƒ
agx.cpu_temp > 80

# å¤åˆæ¡ä»¶
agx.cpu_temp > 80 AND agx.gpu_temp > 75

# èŒƒå›´åˆ¤æ–­
agx.cpu_temp >= 70 AND agx.cpu_temp < 85

# å­—ç¬¦ä¸²æ¯”è¾ƒ
lpmu.status == "running"

# å¸¦æ‹¬å·çš„å¤æ‚æ¡ä»¶
(agx.cpu_temp > 85 OR agx.gpu_temp > 85) AND esp32.power_monitor.voltage > 12

# å­˜åœ¨æ€§æ£€æŸ¥
exists(agx.cpu_temp) AND agx.cpu_temp > 80
```

---

## 5. åŠ¨ä½œç³»ç»Ÿ

### 5.1 åŠ¨ä½œç±»å‹æ¦‚è§ˆ

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `led.touch` | Touch å±å¹•æ˜¾ç¤º | æ˜¾ç¤ºæ–‡å­—ã€æ•°å€¼ |
| `led.board` | æ¿è½½ LED | çŠ¶æ€é¢œè‰²ã€é—ªçƒ |
| `led.matrix` | çŸ©é˜µå±æ˜¾ç¤º | æ•ˆæœã€åŠ¨ç”»ã€æ–‡å­— |
| `ssh` | SSH å‘½ä»¤æ‰§è¡Œ | è¿œç¨‹æ§åˆ¶å‘½ä»¤ |
| `gpio` | GPIO æ§åˆ¶ | ç”µå¹³è®¾ç½® |
| `log` | æ—¥å¿—è®°å½• | è®°å½•åˆ°ç³»ç»Ÿæ—¥å¿— |
| `variable` | å˜é‡æ“ä½œ | è®¾ç½®/æ¸…é™¤å˜é‡ |
| `delay` | å»¶æ—¶ | ç­‰å¾…æŒ‡å®šæ—¶é—´ |
| `trigger_rule` | è§¦å‘è§„åˆ™ | é“¾å¼è§¦å‘å…¶ä»–è§„åˆ™ |
| `conditional` | æ¡ä»¶åŠ¨ä½œ | æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒåŠ¨ä½œ |

### 5.2 LED åŠ¨ä½œ

#### 5.2.1 Touch æ˜¾ç¤º (`led.touch`)

```json
{
  "type": "led.touch",
  "mode": "text",
  "content": "CPU: ${agx.cpu_temp}Â°C\nGPU: ${agx.gpu_temp}Â°C",
  "font_size": 16,
  "color": "#FFFFFF",
  "background": "#000000",
  "duration": 0,
  "page": 0
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `mode` | æ˜¾ç¤ºæ¨¡å¼: `text`, `value`, `chart` | `text` |
| `content` | æ˜¾ç¤ºå†…å®¹ï¼Œæ”¯æŒå˜é‡æ›¿æ¢å’Œ `\n` æ¢è¡Œ | å¿…å¡« |
| `font_size` | å­—ä½“å¤§å° | 16 |
| `color` | æ–‡å­—é¢œè‰² | `#FFFFFF` |
| `background` | èƒŒæ™¯é¢œè‰² | `#000000` |
| `duration` | æ˜¾ç¤ºæŒç»­æ—¶é—´ (ms)ï¼Œ0 = æŒç»­æ˜¾ç¤º | 0 |
| `page` | æ˜¾ç¤ºé¡µé¢ç¼–å· | 0 |

#### 5.2.2 Board LED (`led.board`)

```json
{
  "type": "led.board",
  "color": "#FF0000",
  "blink": true,
  "blink_interval": 500,
  "duration": 5000
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `color` | LED é¢œè‰² (åå…­è¿›åˆ¶æˆ–å‘½åé¢œè‰²) | å¿…å¡« |
| `blink` | æ˜¯å¦é—ªçƒ | false |
| `blink_interval` | é—ªçƒé—´éš” (ms) | 500 |
| `duration` | æŒç»­æ—¶é—´ (ms)ï¼Œ0 = æŒç»­ | 0 |

#### 5.2.3 Matrix æ˜¾ç¤º (`led.matrix`)

```json
{
  "type": "led.matrix",
  "effect": "alert",
  "params": {
    "color": "red",
    "text": "OVERHEAT",
    "speed": 50
  },
  "duration": 0
}
```

**æ”¯æŒçš„æ•ˆæœ**:

| effect | è¯´æ˜ | å‚æ•° |
|--------|------|------|
| `solid` | çº¯è‰² | `color` |
| `alert` | è­¦æŠ¥æ•ˆæœ | `color`, `text` |
| `pulse` | å‘¼å¸æ•ˆæœ | `color`, `speed` |
| `scroll` | æ»šåŠ¨æ–‡å­— | `text`, `color`, `speed` |
| `value` | æ•°å€¼æ˜¾ç¤º | `source`, `format`, `color` |
| `progress` | è¿›åº¦æ¡ | `value`, `max`, `color` |
| `custom` | è‡ªå®šä¹‰å›¾æ¡ˆ | `pattern` (æ•°ç»„) |

### 5.3 SSH åŠ¨ä½œ

```json
{
  "type": "ssh",
  "host": "agx_ssh",
  "command": "sudo jetson_clocks --fan",
  "timeout": 30000,
  "async": false,
  "store_result": "fan_result",
  "on_success": [...],
  "on_failure": [...]
}
```

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `host` | SSH ä¸»æœº ID (åœ¨ ssh_hosts ä¸­å®šä¹‰) | å¿…å¡« |
| `command` | è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ | å¿…å¡« |
| `timeout` | è¶…æ—¶æ—¶é—´ (ms) | 30000 |
| `async` | æ˜¯å¦å¼‚æ­¥æ‰§è¡Œ | false |
| `store_result` | å­˜å‚¨ç»“æœçš„å˜é‡å | - |
| `on_success` | æˆåŠŸæ—¶æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨ | - |
| `on_failure` | å¤±è´¥æ—¶æ‰§è¡Œçš„åŠ¨ä½œåˆ—è¡¨ | - |

**ç»“æœå˜é‡** (å½“ `store_result` è®¾ç½®æ—¶):

```
${fan_result.exit_code}   # é€€å‡ºç 
${fan_result.stdout}      # æ ‡å‡†è¾“å‡º
${fan_result.stderr}      # æ ‡å‡†é”™è¯¯
${fan_result.duration}    # æ‰§è¡Œæ—¶é—´ (ms)
```

### 5.4 æ¡ä»¶åŠ¨ä½œ (`conditional`)

æ ¹æ®æ¡ä»¶æ‰§è¡Œä¸åŒçš„åŠ¨ä½œï¼š

```json
{
  "type": "conditional",
  "conditions": [
    {
      "if": "ssh.last.exit_code == 0",
      "then": [
        {"type": "led.touch", "content": "âœ“ å‘½ä»¤æˆåŠŸ"}
      ]
    },
    {
      "if": "ssh.last.exit_code != 0",
      "then": [
        {"type": "led.touch", "content": "âœ— å‘½ä»¤å¤±è´¥: ${ssh.last.stderr}"},
        {"type": "led.board", "color": "#FF0000", "blink": true}
      ]
    }
  ],
  "else": [
    {"type": "log", "message": "æœªåŒ¹é…ä»»ä½•æ¡ä»¶"}
  ]
}
```

### 5.5 å…¶ä»–åŠ¨ä½œ

#### æ—¥å¿— (`log`)

```json
{
  "type": "log",
  "level": "warn",
  "message": "æ¸©åº¦è¿‡é«˜: CPU=${agx.cpu_temp}Â°C GPU=${agx.gpu_temp}Â°C"
}
```

#### å˜é‡è®¾ç½® (`variable`)

```json
{
  "type": "variable",
  "action": "set",
  "name": "alert_count",
  "value": "${alert_count} + 1"
}
```

#### å»¶æ—¶ (`delay`)

```json
{
  "type": "delay",
  "ms": 5000
}
```

#### è§¦å‘è§„åˆ™ (`trigger_rule`)

```json
{
  "type": "trigger_rule",
  "rule_id": "recovery_procedure"
}
```

---

## 6. é…ç½® Schema

### 6.1 å®Œæ•´é…ç½®ç»“æ„

```json
{
  "version": "1.0",
  "sources": [...],
  "ssh_hosts": [...],
  "rules": [...],
  "commands": [...],
  "displays": {...},
  "secrets": {...}
}
```

### 6.2 å®Œæ•´é…ç½®ç¤ºä¾‹

```json
{
  "version": "1.0",
  
  "sources": [
    {
      "id": "esp32",
      "name": "ESP32 æœ¬æœº",
      "type": "builtin",
      "interval": 1000,
      "fields": [
        {"id": "heap_free", "builtin": "system.heap_free", "name": "å¯ç”¨å†…å­˜"},
        {"id": "voltage", "builtin": "adc.voltage_main", "name": "ä¸»ç”µå‹"},
        {"id": "wifi_rssi", "builtin": "network.wifi_rssi", "name": "WiFiä¿¡å·"}
      ]
    },
    {
      "id": "agx",
      "name": "AGX Orin",
      "type": "websocket",
      "config": {
        "url": "ws://192.168.1.100:58090/socket.io/",
        "reconnect": true
      },
      "interval": 1000,
      "enabled": true,
      "fields": [
        {"id": "cpu_temp", "path": "cpu.temp", "name": "CPUæ¸©åº¦", "unit": "Â°C"},
        {"id": "gpu_temp", "path": "gpu.temp", "name": "GPUæ¸©åº¦", "unit": "Â°C"},
        {"id": "gpu_usage", "path": "gpu.percent", "name": "GPUä½¿ç”¨ç‡", "unit": "%"},
        {"id": "power", "path": "power.watts", "name": "åŠŸè€—", "unit": "W"}
      ]
    },
    {
      "id": "lpmu",
      "name": "LPMU æœåŠ¡å™¨",
      "type": "rest",
      "config": {
        "url": "http://192.168.1.101:8080/api/status",
        "method": "GET"
      },
      "interval": 5000,
      "enabled": true,
      "fields": [
        {"id": "status", "path": "status", "name": "è¿è¡ŒçŠ¶æ€"},
        {"id": "fps", "path": "inference.fps", "name": "æ¨ç†FPS"}
      ]
    }
  ],
  
  "ssh_hosts": [
    {
      "id": "agx_ssh",
      "name": "AGX Orin",
      "host": "192.168.1.100",
      "port": 22,
      "username": "nvidia",
      "auth": "key",
      "key_path": "/sdcard/ssh/agx_key"
    },
    {
      "id": "lpmu_ssh",
      "name": "LPMU",
      "host": "192.168.1.101",
      "port": 22,
      "username": "admin",
      "auth": "password",
      "password_key": "lpmu_password"
    }
  ],
  
  "rules": [
    {
      "id": "normal_display",
      "name": "æ­£å¸¸çŠ¶æ€æ˜¾ç¤º",
      "enabled": true,
      "trigger": {
        "type": "condition",
        "expression": "agx.cpu_temp <= 85 AND agx.gpu_temp <= 85"
      },
      "actions": [
        {
          "type": "led.touch",
          "content": "GPU ${agx.gpu_usage}%\n${agx.gpu_temp}Â°C"
        },
        {
          "type": "led.board",
          "color": "#00FF00"
        },
        {
          "type": "led.matrix",
          "effect": "value",
          "params": {"source": "agx.gpu_usage", "color": "gradient"}
        }
      ]
    },
    {
      "id": "high_temp_alert",
      "name": "é«˜æ¸©è­¦æŠ¥",
      "enabled": true,
      "priority": 10,
      "trigger": {
        "type": "condition",
        "expression": "agx.cpu_temp > 85 OR agx.gpu_temp > 85",
        "debounce": 3000
      },
      "actions": [
        {
          "type": "led.matrix",
          "effect": "alert",
          "params": {"color": "red", "text": "OVERHEAT"}
        },
        {
          "type": "led.board",
          "color": "#FF0000",
          "blink": true
        },
        {
          "type": "ssh",
          "host": "agx_ssh",
          "command": "sudo jetson_clocks --fan"
        },
        {
          "type": "log",
          "level": "warn",
          "message": "é«˜æ¸©è­¦æŠ¥: CPU=${agx.cpu_temp}Â°C GPU=${agx.gpu_temp}Â°C"
        }
      ]
    },
    {
      "id": "low_voltage_protection",
      "name": "ä½ç”µå‹ä¿æŠ¤",
      "enabled": true,
      "priority": 100,
      "trigger": {
        "type": "condition",
        "expression": "esp32.voltage < 11.5",
        "sustain": 10000
      },
      "actions": [
        {
          "type": "led.matrix",
          "effect": "alert",
          "params": {"color": "red", "text": "LOW POWER"}
        },
        {
          "type": "ssh",
          "host": "agx_ssh",
          "command": "sudo shutdown -h now",
          "async": true
        },
        {
          "type": "ssh",
          "host": "lpmu_ssh",
          "command": "sudo shutdown -h now",
          "async": true
        },
        {
          "type": "log",
          "level": "error",
          "message": "ä½ç”µå‹ä¿æŠ¤è§¦å‘: ${esp32.voltage}V"
        }
      ]
    },
    {
      "id": "ssh_feedback",
      "name": "SSH æ‰§è¡Œåé¦ˆ",
      "enabled": true,
      "trigger": {
        "type": "event",
        "event": "ssh.completed"
      },
      "actions": [
        {
          "type": "conditional",
          "conditions": [
            {
              "if": "ssh.last.exit_code == 0",
              "then": [
                {"type": "led.touch", "content": "âœ“ å‘½ä»¤æˆåŠŸ", "duration": 3000}
              ]
            },
            {
              "if": "ssh.last.exit_code != 0",
              "then": [
                {"type": "led.touch", "content": "âœ— å¤±è´¥", "duration": 5000},
                {"type": "led.board", "color": "#FF0000", "duration": 3000}
              ]
            }
          ]
        }
      ]
    }
  ],
  
  "commands": [
    {
      "id": "reboot_agx",
      "name": "é‡å¯ AGX",
      "icon": "restart",
      "category": "power",
      "host": "agx_ssh",
      "command": "sudo reboot",
      "confirm": "ç¡®å®šè¦é‡å¯ AGX å—ï¼Ÿ",
      "require_role": "operator"
    },
    {
      "id": "fan_max",
      "name": "é£æ‰‡å…¨é€Ÿ",
      "icon": "fan",
      "category": "cooling",
      "host": "agx_ssh",
      "command": "sudo jetson_clocks --fan"
    },
    {
      "id": "check_gpu",
      "name": "GPU çŠ¶æ€",
      "icon": "gpu",
      "category": "info",
      "host": "agx_ssh",
      "command": "nvidia-smi --query-gpu=temperature.gpu,utilization.gpu --format=csv,noheader",
      "show_output": true
    },
    {
      "id": "restart_inference",
      "name": "é‡å¯æ¨ç†æœåŠ¡",
      "icon": "refresh",
      "category": "service",
      "host": "lpmu_ssh",
      "command": "sudo systemctl restart inference.service"
    }
  ],
  
  "displays": {
    "default_page_interval": 5000,
    "brightness": 80
  },
  
  "secrets": {
    "storage": "nvs",
    "keys": ["lpmu_password", "lpmu_token"]
  }
}
```

### 6.3 é…ç½®æ–‡ä»¶ä½ç½®

| ä½ç½® | ä¼˜å…ˆçº§ | è¯´æ˜ |
|------|--------|------|
| `/sdcard/config/automation.json` | 1 (æœ€é«˜) | SD å¡é…ç½®ï¼Œå¯çƒ­æ›´æ–° |
| NVS `automation` | 2 | æŒä¹…åŒ–é…ç½® |
| å†…ç½®é»˜è®¤é…ç½® | 3 | ç¼–è¯‘æ—¶é»˜è®¤å€¼ |

---

## 7. WebUI è®¾è®¡

### 7.1 é¡µé¢ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TianShanOS Automation Dashboard                              [å¯¼å‡º] [ä¿å­˜] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  [æ•°æ®æº] [è§„åˆ™] [å‘½ä»¤é¢æ¿] [SSHä¸»æœº] [å®æ—¶ç›‘æ§]                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ æ•°æ®æº â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ“Ÿ ESP32 æœ¬æœº      â”‚  â”‚ ğŸ–¥ï¸ AGX Orin        â”‚  [+ æ·»åŠ æ•°æ®æº]       â”‚  â”‚
â”‚  â”‚  â”‚ builtin | âœ… è¿è¡Œä¸­ â”‚  â”‚ websocket | âœ… è¿æ¥ â”‚                       â”‚  â”‚
â”‚  â”‚  â”‚ å­—æ®µ: 8 | 1000ms   â”‚  â”‚ å­—æ®µ: 7 | 1000ms   â”‚                       â”‚  â”‚
â”‚  â”‚  â”‚ [ç¼–è¾‘] [æµ‹è¯•]      â”‚  â”‚ [ç¼–è¾‘] [æµ‹è¯•]      â”‚                       â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€ è§„åˆ™åˆ—è¡¨ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  â˜ åç§°              è§¦å‘æ¡ä»¶                    åŠ¨ä½œ        çŠ¶æ€      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚  â˜‘ æ­£å¸¸çŠ¶æ€æ˜¾ç¤º      agx.cpu_temp <= 85         LED x3      âœ… æ¿€æ´»   â”‚  â”‚
â”‚  â”‚  â˜‘ é«˜æ¸©è­¦æŠ¥          agx.cpu_temp > 85          LED+SSH     âœ… æ¿€æ´»   â”‚  â”‚
â”‚  â”‚  â˜‘ ä½ç”µå‹ä¿æŠ¤        esp32.voltage < 11.5       SSH x2      âœ… æ¿€æ´»   â”‚  â”‚
â”‚  â”‚  â˜ SSHåé¦ˆ          event: ssh.completed        LED         â¸ ç¦ç”¨   â”‚  â”‚
â”‚  â”‚                                                                       â”‚  â”‚
â”‚  â”‚  [+ æ·»åŠ è§„åˆ™]                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 è§„åˆ™ç¼–è¾‘å™¨

```
â”Œâ”€ ç¼–è¾‘è§„åˆ™: é«˜æ¸©è­¦æŠ¥ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  åŸºæœ¬ä¿¡æ¯                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ è§„åˆ™ID:  high_temp_alert                                            â”‚   â”‚
â”‚  â”‚ åç§°:    [é«˜æ¸©è­¦æŠ¥                    ]                              â”‚   â”‚
â”‚  â”‚ ä¼˜å…ˆçº§:  [10   ] (æ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜)                                 â”‚   â”‚
â”‚  â”‚ å¯ç”¨:    [âœ“]                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  è§¦å‘æ¡ä»¶                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ç±»å‹: [æ¡ä»¶è§¦å‘ â–¼]                                                   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ è¡¨è¾¾å¼æ„å»ºå™¨:                                                        â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                  â”‚   â”‚
â”‚  â”‚ â”‚ agx.cpu_temp  â–¼ â”‚ â”‚ > â–¼â”‚ â”‚ 85  â”‚  [AND â–¼]                        â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                  â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”                                  â”‚   â”‚
â”‚  â”‚ â”‚ agx.gpu_temp  â–¼ â”‚ â”‚ > â–¼â”‚ â”‚ 85  â”‚                                  â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”˜                                  â”‚   â”‚
â”‚  â”‚ [+ æ·»åŠ æ¡ä»¶]                                                         â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ æˆ–ç›´æ¥ç¼–è¾‘: [agx.cpu_temp > 85 OR agx.gpu_temp > 85              ]  â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ é˜²æŠ–: [3000] ms    æŒç»­: [0   ] ms                                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  åŠ¨ä½œåˆ—è¡¨                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1. [LED Matrix â–¼]  æ•ˆæœ: [alert â–¼]  é¢œè‰²: [red]  æ–‡å­—: [OVERHEAT]   â”‚   â”‚
â”‚  â”‚ 2. [LED Board  â–¼]  é¢œè‰²: [#FF0000]  é—ªçƒ: [âœ“]                       â”‚   â”‚
â”‚  â”‚ 3. [SSH å‘½ä»¤   â–¼]  ä¸»æœº: [agx_sshâ–¼] å‘½ä»¤: [sudo jetson_clocks --fan]â”‚   â”‚
â”‚  â”‚ 4. [æ—¥å¿—      â–¼]  çº§åˆ«: [warn â–¼]   æ¶ˆæ¯: [é«˜æ¸©è­¦æŠ¥: ...]            â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ [+ æ·»åŠ åŠ¨ä½œ]                                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚                                              [æµ‹è¯•è§„åˆ™] [å–æ¶ˆ] [ä¿å­˜]        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.3 å®æ—¶ç›‘æ§é¢æ¿

```
â”Œâ”€ å®æ—¶ç›‘æ§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  æ•°æ®æºçŠ¶æ€                              å½“å‰å˜é‡å€¼                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ESP32    âœ… è¿è¡Œä¸­ | 1.0s   â”‚       â”‚ esp32.heap_free     = 156 KB    â”‚  â”‚
â”‚  â”‚ AGX      âœ… è¿æ¥ä¸­ | 1.0s   â”‚       â”‚ esp32.voltage       = 12.8 V    â”‚  â”‚
â”‚  â”‚ LPMU     âš ï¸ è¶…æ—¶   | 5.0s   â”‚       â”‚ agx.cpu_temp        = 67 Â°C     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ agx.gpu_temp        = 72 Â°C     â”‚  â”‚
â”‚                                        â”‚ agx.gpu_usage       = 45 %      â”‚  â”‚
â”‚  è§„åˆ™çŠ¶æ€                               â”‚ lpmu.status         = (è¶…æ—¶)    â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ æ­£å¸¸çŠ¶æ€æ˜¾ç¤º  â— æ¿€æ´»ä¸­      â”‚                                           â”‚  â”‚
â”‚  â”‚ é«˜æ¸©è­¦æŠ¥      â—‹ å¾…å‘½        â”‚       æœ€è¿‘åŠ¨ä½œ                            â”‚  â”‚
â”‚  â”‚ ä½ç”µå‹ä¿æŠ¤    â—‹ å¾…å‘½        â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ SSHåé¦ˆ       â—‹ ç¦ç”¨        â”‚       â”‚ 12:34:56 LED.touch æ›´æ–°æ˜¾ç¤º    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚ 12:34:55 LED.matrix æ›´æ–°æ•ˆæœ   â”‚  â”‚
â”‚                                        â”‚ 12:34:50 SSH agx_ssh æ‰§è¡Œå®Œæˆ  â”‚  â”‚
â”‚                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. ç»„ä»¶è®¾è®¡

### 8.1 ç»„ä»¶åˆ—è¡¨

| ç»„ä»¶ | è·¯å¾„ | èŒè´£ |
|------|------|------|
| `ts_automation` | `components/ts_automation/` | æ ¸å¿ƒå¼•æ“ï¼šé…ç½®åŠ è½½ã€è°ƒåº¦åè°ƒ |
| `ts_source` | `components/ts_source/` | æ•°æ®æºç®¡ç†ï¼šå†…ç½®/WS/REST é‡‡é›† |
| `ts_rule` | `components/ts_rule/` | è§„åˆ™å¼•æ“ï¼šæ¡ä»¶è§£æã€è¡¨è¾¾å¼æ±‚å€¼ |
| `ts_action` | `components/ts_action/` | åŠ¨ä½œæ‰§è¡Œï¼šç»Ÿä¸€åŠ¨ä½œæ¥å£ |
| `ts_variable` | `components/ts_variable/` | å˜é‡å­˜å‚¨ï¼šæ•°æ®ç‚¹ç®¡ç†ã€å˜é‡å¼•ç”¨ |

### 8.2 ç»„ä»¶ä¾èµ–

```
ts_automation
    â”œâ”€â”€ ts_source
    â”‚   â”œâ”€â”€ ts_net (WS/HTTP å®¢æˆ·ç«¯)
    â”‚   â””â”€â”€ ts_variable
    â”œâ”€â”€ ts_rule
    â”‚   â””â”€â”€ ts_variable
    â”œâ”€â”€ ts_action
    â”‚   â”œâ”€â”€ ts_led (LED API)
    â”‚   â”œâ”€â”€ ts_security (SSH)
    â”‚   â””â”€â”€ ts_variable
    â””â”€â”€ ts_storage (é…ç½®æŒä¹…åŒ–)
```

### 8.3 æ ¸å¿ƒ API è®¾è®¡

#### ts_automation.h

```c
/**
 * @brief åˆå§‹åŒ–è‡ªåŠ¨åŒ–å¼•æ“
 * @param config_path é…ç½®æ–‡ä»¶è·¯å¾„ï¼ŒNULL ä½¿ç”¨é»˜è®¤è·¯å¾„
 * @return ESP_OK æˆåŠŸ
 */
esp_err_t ts_automation_init(const char *config_path);

/**
 * @brief å¯åŠ¨è‡ªåŠ¨åŒ–å¼•æ“
 */
esp_err_t ts_automation_start(void);

/**
 * @brief åœæ­¢è‡ªåŠ¨åŒ–å¼•æ“
 */
esp_err_t ts_automation_stop(void);

/**
 * @brief é‡æ–°åŠ è½½é…ç½®
 */
esp_err_t ts_automation_reload(void);

/**
 * @brief è·å–å¼•æ“çŠ¶æ€
 */
ts_automation_status_t ts_automation_get_status(void);
```

#### ts_source.h

```c
/**
 * @brief æ³¨å†Œæ•°æ®æº
 */
esp_err_t ts_source_register(const ts_source_config_t *config);

/**
 * @brief è·å–å˜é‡å€¼
 * @param source_id æ•°æ®æº ID
 * @param field_id å­—æ®µ ID
 * @param value è¾“å‡ºå€¼
 */
esp_err_t ts_source_get_value(const char *source_id, const char *field_id, 
                               ts_value_t *value);

/**
 * @brief æ³¨å†Œå†…ç½®æ•°æ®æä¾›è€…
 */
esp_err_t ts_source_register_builtin(const char *builtin_id, 
                                      ts_builtin_provider_fn provider);
```

#### ts_rule.h

```c
/**
 * @brief æ³¨å†Œè§„åˆ™
 */
esp_err_t ts_rule_register(const ts_rule_config_t *config);

/**
 * @brief å¯ç”¨/ç¦ç”¨è§„åˆ™
 */
esp_err_t ts_rule_set_enabled(const char *rule_id, bool enabled);

/**
 * @brief æ‰‹åŠ¨è§¦å‘è§„åˆ™ï¼ˆæµ‹è¯•ç”¨ï¼‰
 */
esp_err_t ts_rule_trigger(const char *rule_id);
```

#### ts_action.h

```c
/**
 * @brief æ³¨å†ŒåŠ¨ä½œæ‰§è¡Œå™¨
 */
esp_err_t ts_action_register(const char *type, ts_action_handler_fn handler);

/**
 * @brief æ‰§è¡ŒåŠ¨ä½œ
 */
esp_err_t ts_action_execute(const ts_action_t *action);
```

---

## 9. å®ç°è®¡åˆ’

### Phase 1: æ ¸å¿ƒæ¡†æ¶ (é¢„è®¡ 2 å¤©)

**ç›®æ ‡**: å»ºç«‹åŸºæœ¬æ¶æ„ï¼Œé…ç½®åŠ è½½

- [ ] åˆ›å»º `ts_automation` ç»„ä»¶éª¨æ¶
- [ ] å®šä¹‰é…ç½® JSON Schema
- [ ] å®ç°é…ç½®æ–‡ä»¶åŠ è½½ (SD å¡ / NVS)
- [ ] å®ç°é…ç½®éªŒè¯
- [ ] åˆ›å»º `ts_variable` å˜é‡å­˜å‚¨

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤ŸåŠ è½½å¹¶è§£æ JSON é…ç½®æ–‡ä»¶

### Phase 2: æ•°æ®æºç³»ç»Ÿ (é¢„è®¡ 3 å¤©)

**ç›®æ ‡**: å®ç°æ•°æ®é‡‡é›†

- [ ] åˆ›å»º `ts_source` ç»„ä»¶
- [ ] å®ç°å†…ç½®æ•°æ®æº (ESP32 ç³»ç»Ÿ/ç½‘ç»œ/ADC)
- [ ] å®ç° WebSocket æ•°æ®æº
- [ ] å®ç° REST æ•°æ®æº
- [ ] JSON Path å­—æ®µæå–
- [ ] æ•°æ®æ›´æ–°äº‹ä»¶å‘å¸ƒ

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿé‡‡é›† ESP32 æœ¬åœ°æ•°æ®å’Œæ¨¡æ‹Ÿçš„è¿œç¨‹æ•°æ®

### Phase 3: è§„åˆ™å¼•æ“ (é¢„è®¡ 3 å¤©)

**ç›®æ ‡**: å®ç°æ¡ä»¶åˆ¤æ–­

- [ ] åˆ›å»º `ts_rule` ç»„ä»¶
- [ ] å®ç°è¡¨è¾¾å¼è§£æå™¨
- [ ] å®ç°æ¡ä»¶æ±‚å€¼
- [ ] å®ç°è§¦å‘å™¨ç±»å‹ (condition/event/timer)
- [ ] é˜²æŠ–/æŒç»­æ—¶é—´é€»è¾‘
- [ ] è§„åˆ™ä¼˜å…ˆçº§å¤„ç†

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿæ ¹æ®æ¡ä»¶è§¦å‘è§„åˆ™

### Phase 4: åŠ¨ä½œç³»ç»Ÿ (é¢„è®¡ 2 å¤©)

**ç›®æ ‡**: å®ç°åŠ¨ä½œæ‰§è¡Œ

- [ ] åˆ›å»º `ts_action` ç»„ä»¶
- [ ] å®ç° LED åŠ¨ä½œ (touch/board/matrix)
- [ ] å®ç° SSH åŠ¨ä½œ (é›†æˆç°æœ‰ API)
- [ ] å®ç°æ—¥å¿—/å˜é‡/å»¶æ—¶åŠ¨ä½œ
- [ ] æ¡ä»¶åŠ¨ä½œæ”¯æŒ
- [ ] åŠ¨ä½œé“¾å¼æ‰§è¡Œ

**éªŒæ”¶æ ‡å‡†**: è§„åˆ™è§¦å‘åèƒ½æ­£ç¡®æ‰§è¡ŒåŠ¨ä½œ

### Phase 5: WebUI (é¢„è®¡ 4 å¤©)

**ç›®æ ‡**: å¯è§†åŒ–é…ç½®ç•Œé¢

- [ ] æ•°æ®æºé…ç½®é¡µé¢
- [ ] è§„åˆ™ç¼–è¾‘å™¨
- [ ] å‘½ä»¤é¢æ¿é…ç½®
- [ ] SSH ä¸»æœºç®¡ç†
- [ ] å®æ—¶ç›‘æ§é¢æ¿
- [ ] é…ç½®å¯¼å…¥/å¯¼å‡º

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿé€šè¿‡ WebUI å®Œæ•´é…ç½®è‡ªåŠ¨åŒ–ç³»ç»Ÿ

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (é¢„è®¡ 2 å¤©)

- [ ] å•å…ƒæµ‹è¯•
- [ ] é›†æˆæµ‹è¯•
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] å†…å­˜ä½¿ç”¨ä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

---

## 10. é™„å½•

### A. å˜é‡å¼•ç”¨è¯­æ³•

```
${source_id.field_id}           # åŸºæœ¬å¼•ç”¨
${source_id.field_id:%.2f}      # å¸¦æ ¼å¼åŒ–
${source_id.field_id:default}   # é»˜è®¤å€¼
```

### B. å†…ç½®äº‹ä»¶åˆ—è¡¨

| äº‹ä»¶ | è¯´æ˜ |
|------|------|
| `startup` | ç³»ç»Ÿå¯åŠ¨å®Œæˆ |
| `data.updated.<source_id>` | æ•°æ®æºæ›´æ–° |
| `ssh.completed` | SSH å‘½ä»¤å®Œæˆ |
| `ssh.timeout` | SSH å‘½ä»¤è¶…æ—¶ |
| `network.wifi_connected` | WiFi è¿æ¥ |
| `network.wifi_disconnected` | WiFi æ–­å¼€ |
| `network.ip_changed` | IP åœ°å€å˜æ›´ |
| `service.started.<name>` | æœåŠ¡å¯åŠ¨ |
| `service.stopped.<name>` | æœåŠ¡åœæ­¢ |
| `timer.<interval>` | å®šæ—¶å™¨è§¦å‘ |

### C. é¢œè‰²æ ¼å¼

æ”¯æŒä»¥ä¸‹é¢œè‰²æ ¼å¼ï¼š

- åå…­è¿›åˆ¶: `#FF0000`, `#F00`
- RGB: `rgb(255, 0, 0)`
- å‘½åé¢œè‰²: `red`, `green`, `blue`, `yellow`, `orange`, `white`, `black`
- æ¸å˜: `gradient` (æ ¹æ®æ•°å€¼è‡ªåŠ¨æ˜ å°„)

### D. ä¿®è®¢å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´ |
|------|------|------|
| 1.0 | 2026-01-26 | åˆå§‹ç‰ˆæœ¬ |
